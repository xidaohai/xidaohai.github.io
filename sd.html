<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰é˜¶æ ¡å‡†æ³•Â·åˆé˜¶é—ªç”µç®—</title>
    <style>
        /* =========================================================================
         * A. é¢œè‰²å˜é‡ä¸ä¸“ä¸šç¾å­¦åŸºç¡€
         * ========================================================================= */
        :root {
            --color-dark: #2c3e50; /* æ·±è“ç° - ä¸»è¦æ–‡æœ¬/å®¹å™¨ */
            --color-light-bg: #f9fbfd; /* ææµ…èƒŒæ™¯ */
            --color-card-bg: #ffffff; /* å¡ç‰‡èƒŒæ™¯ */
            --color-border: #e0e6ed; /* æµ…è¾¹æ¡† */
            --color-accent-base: #3498db; /* åŸºç¡€ä¸“ä¸šè“ */
            --color-accent-r1: #2980b9; /* é˜¶æ®µ1ï¼šæ·±è“ */
            --color-accent-r2: #16a085; /* é˜¶æ®µ2ï¼šå¢¨ç»¿ */
            --color-accent-r3: #e67e22; /* é˜¶æ®µ3ï¼šç¨³å®šæ©™ */
            --color-warning: #e74c3c; /* è­¦ç¤ºçº¢ - æœ€ç»ˆé¢œè‰² */
            --color-highlight: #f1c40f; /* é»„é‡‘è‰² - è¯„ä»· */
            --border-radius: 6px;
            --shadow-subtle: 0 4px 12px rgba(0, 0, 0, 0.05);
            --current-accent: var(--color-accent-r1); /* åŠ¨æ€é˜¶æ®µè‰² */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', 'Arial', sans-serif, 'Microsoft YaHei', 'SimHei';
        }
        
        body {
            background-color: var(--color-light-bg);
            color: var(--color-dark);
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        
        /* --- æ ¸å¿ƒç»“æ„ï¼šåŒé¢æ¿å¸ƒå±€ --- */
        .main-container {
            display: flex;
            max-width: 1400px; 
            width: 100%;
            gap: 20px;
        }
        
        .panel {
            background-color: var(--color-card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-subtle);
            border: 1px solid var(--color-border);
            padding: 25px;
        }
        
        .controls-panel {
            flex: 2; 
        }
        
        .results-panel {
            flex: 1; 
            position: sticky;
            top: 20px;
            height: fit-content;
        }
        
        /* --- æ ‡é¢˜ä¸ä¿¡æ¯å¡ --- */
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--color-dark);
            font-size: 2.2em;
            font-weight: 700;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-border);
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 18px;
            color: var(--current-accent);
            padding-bottom: 5px;
            border-bottom: 2px solid #f0f0f0;
        }

        .info-card {
            background-color: #f7f9fc; 
            border-radius: var(--border-radius);
            padding: 15px 20px;
            margin-bottom: 25px;
            border-left: 4px solid var(--current-accent);
            line-height: 1.8;
            font-size: 0.95em;
        }
        
        /* --- é˜¶æ®µè¾“å…¥åŒº --- */
        .phase-section {
            padding: 20px;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            background-color: var(--color-card-bg);
        }
        
        /* --- è¿œè¿‘çº¬åº¦ (å‚ç›´å †å ) - ç§»é™¤æ•°å­—ï¼Œèšç„¦æ ‡ç­¾ --- */
        .distance-buttons {
            display: flex; 
            flex-direction: column;
            gap: 10px; 
            margin-top: 15px;
        }
        
        .distance-btn {
            width: 100%; 
            padding: 15px 15px; 
            border: 2px solid var(--color-border);
            background-color: #ffffff;
            font-size: 1.0em; 
            transition: all 0.3s ease;
            border-radius: var(--border-radius);
            cursor: pointer;
            text-align: left; 
            display: flex;
            align-items: center;
            justify-content: center; /* æŒ‰é’®å†…å®¹å±…ä¸­ */
            line-height: 1.3;
        }

        .distance-btn:hover:not(:disabled) {
            border-color: var(--color-accent-base);
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        .distance-btn.active {
            border-color: var(--current-accent);
            background-color: #eaf1f7; 
            color: var(--color-dark);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        /* éšè—åº¦æ•°æ ‡ç­¾ */
        .btn-degree {
            display: none;
        }

        /* æå‡ä¸­æ–‡æ ‡ç­¾çš„è§†è§‰æƒé‡ */
        .btn-label {
            font-size: 1.2em; /* å¢å¤§å­—ä½“ï¼Œä½¿å…¶æˆä¸ºä¸»è¦å†…å®¹ */
            font-weight: 700; /* ç²—ä½“ */
            color: var(--color-dark); /* ä½¿ç”¨æ·±è‰² */
            margin: 0; /* ç§»é™¤è¾¹è· */
            flex-grow: unset; 
            text-align: center; /* æ–‡æœ¬å±…ä¸­ */
        }
        
        .distance-btn.active .btn-label {
            color: var(--current-accent); /* é€‰ä¸­æ—¶ä½¿ç”¨å¼ºè°ƒè‰² */
        }
        
        /* å¿«æ…¢çº¬åº¦ æ»‘å—å’Œæ˜Ÿçº§ä¿æŒ v15.3 ä¼˜åŒ– */
        .dimension-value {
             font-size: 1.8em;
             font-weight: 700;
             color: var(--current-accent);
        }
        
        .slider-container {
            padding: 15px 0; 
        }
        
        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px; 
            background: #ddd;
            border-radius: 5px;
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px; 
            height: 24px; 
            background: var(--current-accent);
            border-radius: 50%;
            cursor: grab;
            border: 4px solid var(--color-card-bg); 
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        .slider::-moz-range-thumb {
             width: 24px;
             height: 24px;
             background: var(--current-accent);
             border-radius: 50%;
             cursor: grab;
             border: 4px solid var(--color-card-bg);
             box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        .stars-container {
            display: flex; 
            justify-content: center;
            gap: 15px; 
            margin-top: 10px;
            margin-bottom: 15px;
        }
        
        .star {
            font-size: 3em; 
            color: #ccc;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star.active {
            color: var(--color-highlight); 
            text-shadow: 0 0 8px rgba(241, 196, 15, 0.6); 
        }
        
        /* --- åŠ¨ä½œæŒ‰é’® (ä¿æŒ v15.3 ä¼˜åŒ–) --- */
        .action-buttons {
            display: flex;
            gap: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--color-border);
            justify-content: center;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 12px 30px; 
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .apply-btn {
            background-color: var(--current-accent); 
            color: var(--color-card-bg); 
        }
        
        .apply-btn:hover:not(:disabled) {
            background-color: var(--color-accent-base); 
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        
        .apply-btn:disabled {
            background-color: #bdc3c7; 
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .reset-btn {
            background-color: transparent;
            border: 2px solid #ccc;
            color: var(--color-dark);
        }
        
        .reset-btn:hover {
            border-color: var(--color-warning);
            color: var(--color-warning);
        }

        /* --- å•ä½åˆ‡æ¢æŒ‰é’® (ä¿æŒ v15.3 ä¼˜åŒ–) --- */
        .unit-toggle {
            display: flex;
            background-color: #eef3f7; 
            border-radius: var(--border-radius);
            padding: 3px;
            border: 1px solid #dcdcdc; 
            margin-left: 20px; 
        }
        
        .unit-toggle button {
            flex: 1;
            padding: 10px 15px; 
            border: none;
            background: transparent;
            border-radius: calc(var(--border-radius) - 2px);
            cursor: pointer;
            font-size: 0.95em; 
            transition: all 0.2s ease;
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .unit-toggle button.active {
            background-color: var(--color-card-bg);
            color: var(--color-dark);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
            font-weight: 700;
        }
        
        /* --- DPI è¾“å…¥ (ä¿æŒ v15.3 ä¼˜åŒ–) --- */
        .dpi-input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            margin-bottom: 20px;
            gap: 15px;
        }
        .dpi-input-group input {
            padding: 10px 12px; 
            border: 2px solid var(--color-border); 
            border-radius: var(--border-radius);
            width: 120px; 
            text-align: center;
            font-size: 1.2em; 
            transition: border-color 0.3s;
        }

        .dpi-input-group input:focus {
            outline: none;
            border-color: var(--color-accent-base);
        }
        
        /* --- ä¸»çµæ•åº¦å¡ç‰‡ (Result Panel) - é¢œè‰²éšé˜¶æ®µå˜åŒ– --- */
        .main-sens-card {
            background-color: #f7f9fc; 
            border-radius: var(--border-radius);
            padding: 20px 10px;
            margin: 15px 0 25px 0; 
            border-left: 5px solid var(--current-accent); /* åŠ¨æ€é¢œè‰²è¾¹æ¡† */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        /* æµç¨‹ç»ˆç»“æ—¶å¼ºåˆ¶ä½¿ç”¨çº¢è‰² */
        .main-sens-card.finalized {
            border-left-color: var(--color-warning) !important;
        }
        
        .sensitivity-value {
            font-size: 3.8em; 
            font-weight: 800;
            text-align: center;
            margin: 5px 0;
            transition: color 0.3s;
            color: var(--color-dark); /* é»˜è®¤æ·±è‰² */
        }
        
        /* æœ€ç»ˆç»“æœæ—¶é¢œè‰²ä¸ºçº¢è‰² */
        .sensitivity-value.final-result {
            color: var(--color-warning); 
            animation: none; 
        }

        .sensitivity-range {
            text-align: center;
            color: #666;
            font-size: 1.0em;
            margin-bottom: 5px;
        }
        
        /* --- æ¸¸æˆçµæ•åº¦å¡ç‰‡ --- */
        .game-sens-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px; 
            margin-top: 20px;
        }
        .game-sens-card {
            background-color: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 15px 10px;
            text-align: center;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
            transition: border-color 0.2s;
        }
        .game-sens-card:hover {
            border-color: #bdc3c7;
        }
        .game-name {
            font-size: 0.9em;
            font-weight: 600;
            color: #95a5a6;
            margin-bottom: 5px;
        }
        .game-sens-value {
            font-size: 1.6em;
            font-weight: 700;
            color: var(--color-dark);
            line-height: 1.2;
        }
        .game-sens-hint {
            font-size: 0.8em;
            color: #bdc3c7;
            margin-top: 5px;
        }

        /* --- æ‚¬æµ®æŒ‰é’®æ ·å¼ V32.0 (ç¾åŒ–) --- */
        .floating-button-container {
            position: fixed;
            bottom: 30px; 
            right: 30px;
            z-index: 1000;
        }
        .floating-button {
            background-color: #2980b9; 
            background-image: linear-gradient(45deg, #3498db, #2980b9); /* æ¸å˜ */
            color: white;
            padding: 15px;
            border-radius: 50%;
            width: 90px; 
            height: 90px;
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); 
            transition: all 0.3s ease;
            text-decoration: none; 
            border: 4px solid #ffffffa0; 
        }
        .floating-button:hover {
            background-image: linear-gradient(45deg, #5dade2, #3498db); /* é¼ æ ‡æ‚¬åœå˜äº® */
            transform: scale(1.1) translateY(-3px); /* æ”¾å¤§å¹¶å‘ä¸Šæµ®åŠ¨ */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
        }
        .floating-button-icon {
            font-size: 1.5em; 
            margin-bottom: 2px;
            line-height: 1;
        }
        .floating-button-text {
            font-size: 0.9em; 
            line-height: 1.2;
            text-align: center;
        }

    </style>
</head>
<body>
    <div class="main-container">
        
        <div class="panel controls-panel" id="main-container">
            <h1>è¥¿å²›æµ· Â· FPSæ¸¸æˆ çµæ•åº¦é—ªç”µç®—</h1>
            
            <div class="info-card">
                <p><strong>å…¨å±€è®¾å®šèŒƒå›´:</strong> 70cm/360&deg; (æœ€æ…¢) åˆ° 35cm/360&deg; (æœ€å¿«)</p>
                <p class="step-info"><strong>PerCM ç»Ÿä¸€æ­¥é•¿ (Adjustment Â°/1cm):</strong> <span id="current-base-d-step">0.0000</span></p> 
                <p class="step-info"><strong>ç²¾å¯†è°ƒæ•´åŒºé—´ (ç¡¬æ€§é”å®š S<sub>+1</sub> åˆ° S<sub>-1</sub>):</strong> <span id="precision-range-display">è¯·å…ˆé€‰æ‹©è¿œè¿‘çº¬åº¦</span></p>
            </div>
            
            <div id="adjustment-controls">
                <div id="distance-phase" class="phase-section">
                    <div class="section-title">é˜¶æ®µ 1/3: è¿œè¿‘çº¬åº¦é€‰æ‹© (åŸºç¡€è®¾å®š)</div>
                    <div class="distance-buttons">
                        <button class="distance-btn" data-value="70">
                            <span class="btn-degree">70cm/360Â°</span>
                            <span class="btn-label">æœ€è¿œï¼ˆç›®æ ‡å°ï¼‰</span>
                        </button>
                        
                        <button class="distance-btn" data-value="57.5">
                            <span class="btn-degree">57.5cm/360Â°</span>
                            <span class="btn-label">ä¸­è¿œ</span>
                        </button>
                        
                        <button class="distance-btn" data-value="45">
                            <span class="btn-degree">45cm/360Â°</span>
                            <span class="btn-label">ä¸­</span>
                        </button>
                        
                        <button class="distance-btn" data-value="40">
                            <span class="btn-degree">40cm/360Â°</span>
                            <span class="btn-label">ä¸­è¿‘</span>
                        </button>
                        
                        <button class="distance-btn" data-value="35">
                            <span class="btn-degree">35cm/360Â°</span>
                            <span class="btn-label">è´´è„¸ï¼ˆç›®æ ‡å¤§ï¼‰</span>
                        </button>
                    </div>
                </div>

                <div id="adjustment-input-area">
                    <div id="speed-phase" class="phase-section" style="display: none;">
                        <div class="section-title">é˜¶æ®µ 2/3: å¿«æ…¢çº¬åº¦è°ƒèŠ‚ (å½“å‰è½®æ¬¡: <span id="adjustment-count-display">0</span>)</div>
                        <div class="dimension">
                            <div class="dimension-header">
                                <span class="dimension-name" id="speed-range-display">è°ƒæ•´å¹…åº¦ [åŠ¨æ€èŒƒå›´]</span>
                                <span class="dimension-value" id="speed-value">0</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" min="-7" max="7" value="0" class="slider" id="speed-slider">
                            </div>
                            <div class="slider-labels" style="display:flex; justify-content:space-between; font-size:0.9em; color:#999;">
                                <span>å¿«æé™</span>
                                <span>æ…¢æé™</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="usability-phase" class="phase-section" style="display: none;">
                        <div class="section-title">é˜¶æ®µ 3/3: å¥½ç”¨çº¬åº¦è¯„ä»· (è¯·å¯¹ç»“æœåšå‡ºå†³ç­–)</div>
                        <div class="dimension-header" style="justify-content: center;">
                            <span class="dimension-name">è¯·å¯¹å½“å‰çµæ•åº¦è¿›è¡Œè¯„ä»· (æ»¡åˆ† 3 æ˜Ÿ)</span>
                        </div>
                        <div class="stars-container" id="stars-container">
                            <div class="star" data-rating="1">â˜…</div>
                            <div class="star active" data-rating="2">â˜…</div>
                            <div class="star" data-rating="3">â˜…</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons" id="action-buttons" style="display: none;">
                <button class="action-btn apply-btn" id="apply-btn" disabled>åº”ç”¨è°ƒæ•´</button>
                <button class="action-btn reset-btn" id="reset-btn">é‡ç½®ç³»ç»Ÿ</button>
            </div>
        </div>

        <div class="panel results-panel">
             <div class="result-section">
                <div class="dimension-header" style="align-items: center;">
                    <h2 style="font-size:1.5em; color:var(--color-dark);">å®æ—¶çµæ•åº¦ç›‘æµ‹</h2>
                    <div class="unit-toggle">
                        <button class="unit-btn" id="cm5-unit">5cm/å¤šå°‘&deg;</button>
                        <button class="unit-btn active" id="cm360-unit">cm/360&deg;</button>
                    </div>
                </div>
                
                <div class="main-sens-card">
                    <div class="sensitivity-value" id="sensitivity-result">è¯·å…ˆé€‰æ‹©è¿œè¿‘çº¬åº¦</div> 
                    <div class="sensitivity-range" id="sensitivity-range"></div>
                </div>
            </div>

            <div class="dpi-input-group">
                <label for="dpi-input">å½“å‰ DPI:</label>
                <input type="number" id="dpi-input" value="400" min="100" step="100" oninput="updateDisplay()">
            </div>

            <div class="game-sensitivity-display">
                <div class="section-title" style="text-align: center; margin-bottom: 10px;">ğŸ® æ¸¸æˆçµæ•åº¦å®æ—¶æ¢ç®— (DPI: <span id="current-dpi-display">400</span>)</div>
                <div class="game-sens-grid">
                    <div class="game-sens-card">
                        <div class="game-name">CS / Apex</div>
                        <div class="game-sens-value" id="sens-cs">N/A</div>
                        <div class="game-sens-hint">çµæ•åº¦ (m_yaw=0.022)</div>
                    </div>
                    <div class="game-sens-card">
                        <div class="game-name">Valorant</div>
                        <div class="game-sens-value" id="sens-val">N/A</div>
                        <div class="game-sens-hint">çµæ•åº¦ (m_yaw=0.07)</div>
                    </div>
                    <div class="game-sens-card">
                        <div class="game-name">Overwatch</div>
                        <div class="game-sens-value" id="sens-ow">N/A</div>
                        <div class="game-sens-hint">çµæ•åº¦ (m_yaw=0.0066)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="floating-button-container">
        <a href="https://space.bilibili.com/1534330" id="user-address-link" class="floating-button" title="ç‚¹å‡»è¿›å…¥æˆ‘çš„ç½‘é¡µ">
            <span class="floating-button-icon">ğŸ”—</span>
            <span class="floating-button-text">ä½œè€…ï¼šè¥¿å²›æµ·</span>
        </a>
    </div>

    <script>
        // =========================================================================
        // A. å¸¸é‡ä¸çŠ¶æ€å˜é‡ (æ ¸å¿ƒæ•°æ®) - V32.0 
        // =========================================================================

        const MAX_ADJUSTMENTS = 2; // è°ƒæ•´æ¬¡æ•°ä¸Šé™
        const TOLERANCE = 0.0001; 
        
        // CM/360Â° æ­¥è¿›å€¼ (CM360æ•°å€¼è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ…¢)
        const ALL_STEPS_CM360 = [70, 57.5, 45, 40, 35]; // [æœ€æ…¢, ä¸­æ…¢, ä¸­, ä¸­å¿«, æœ€å¿«]
        
        // ç”¨æˆ·æä¾›çš„æ¢ç®—å¸¸æ•° (360 * 2.54 / m_yaw)
        const CONST_CS = 41563.636; 
        const CONST_VAL = 13062.857;
        const CONST_OW = 138545.455;
        
        const PHASE_COLORS = {
            0: 'var(--color-accent-r1)', // AC=1 çš„é¢œè‰²
            1: 'var(--color-accent-r2)', // AC=2 çš„é¢œè‰²
            2: 'var(--color-accent-r3)'
        };
        
        let currentPhase = 'distance'; 
        let currentDegreesFor5cm = 0; // ç³»ç»Ÿæ ¸å¿ƒè®¡ç®—å•ä½ï¼š5cm/å¤šå°‘Â°
        let adjustmentCounter = 0; // è®°å½•å·²å®Œæˆçš„è°ƒæ•´æ¬¡æ•° (0, 1, 2)
        let currentStarRating = 2; 
        let isFinalized = false;
        
        let PRECISION_MIN = 0; // Degrees for 5cm (æ…¢æé™ S+1 - æœ€ä½ PerCM)
        let PRECISION_MAX = 0; // Degrees for 5cm (å¿«æé™ S-1 - æœ€é«˜ PerCM)
        
        const rootElement = document.documentElement;
        const distanceButtons = document.querySelectorAll('.distance-btn');
        const usabilityStars = document.querySelectorAll('#stars-container .star');
        const speedSlider = document.getElementById('speed-slider');
        const applyBtn = document.getElementById('apply-btn');
        const sensitivityResult = document.getElementById('sensitivity-result');
        const precisionRangeDisplay = document.getElementById('precision-range-display');
        const dpiInput = document.getElementById('dpi-input');
        const sensCS = document.getElementById('sens-cs');
        const sensVal = document.getElementById('sens-val');
        const sensOW = document.getElementById('sens-ow');
        const currentDpiDisplay = document.getElementById('current-dpi-display');
        const cm5UnitBtn = document.getElementById('cm5-unit');
        const cm360UnitBtn = document.getElementById('cm360-unit');
        const speedRangeDisplay = document.getElementById('speed-range-display');

        // å°† CM360 æ­¥è¿›å€¼è½¬æ¢ä¸º Degrees æ­¥è¿›å€¼
        function toDegreesFor5cm(cm360) {
            // 5cm/å¤šå°‘Â° = (5 * 360) / cm360
            return cm360 === 0 ? 0 : (5 * 360) / cm360; // é¿å…é™¤ä»¥é›¶
        }

        const ALL_STEPS_DEGREES = ALL_STEPS_CM360.map(toDegreesFor5cm);
        const MIN_DEGREES = ALL_STEPS_DEGREES[0]; // 70cm å¯¹åº”çš„ Degrees (æœ€æ…¢)
        const MAX_DEGREES = ALL_STEPS_DEGREES[ALL_STEPS_DEGREES.length - 1]; // 35cm å¯¹åº”çš„ Degrees (æœ€å¿«)

        // =========================================================================
        // B. æ ¸å¿ƒè®¡ç®—å‡½æ•° 
        // =========================================================================
        
        /** è½¬æ¢ä¸º cm/360Â° */
        function toCM360(degrees) {
            // cm/360Â° = (5cm * 360Â°) / XÂ°
            return degrees === 0 ? Infinity : (5 * 360) / degrees;
        }
        
        /** è½¬æ¢ä¸º PerCM (Â°/1cm) */
        function toPerCM(degreesFor5cm) {
            // PerCM = (degreesFor5cm / 5)
            return degreesFor5cm / 5;
        }
        
        /** è½¬æ¢ä¸º DegreesFor5cm (5cm/å¤šå°‘Â°) */
        function toDegreesFor5cmFromPerCM(perCM) {
             // degreesFor5cm = perCM * 5
            return perCM * 5;
        }

        /** æŸ¥æ‰¾å¹¶è®¾ç½®ç¡¬æ€§ç²¾å¯†è°ƒæ•´åŒºé—´è¾¹ç•Œ */
        function setHardPrecisionBounds(S0_degrees) { 
            
            const cm360_value = toCM360(S0_degrees);
            const index = ALL_STEPS_DEGREES.findIndex(step => Math.abs(step - S0_degrees) < TOLERANCE);
            
            if (index === -1) {
                PRECISION_MIN = MIN_DEGREES; 
                PRECISION_MAX = MAX_DEGREES; 
                return;
            }
            
            // --- ç‹¬ç«‹è¾¹ç•Œå¤„ç† START ---
            if (Math.abs(cm360_value - 70) < TOLERANCE) { // æœ€è¿œ (æœ€æ…¢, Index 0)
                // S0 = 70cm/360Â°. S+1 = 70cm. S-1 = 57.5cm.
                PRECISION_MIN = ALL_STEPS_DEGREES[0]; // 70cm (æ…¢è¾¹ç•Œ, Degreesæœ€å°)
                PRECISION_MAX = ALL_STEPS_DEGREES[1]; // 57.5cm (å¿«è¾¹ç•Œ, Degreesè¾ƒå¤§)
            } else if (Math.abs(cm360_value - 35) < TOLERANCE) { // è´´è„¸ (æœ€å¿«, Index 4)
                // S0 = 35cm/360Â°. S+1 = 40cm. S-1 = 35cm.
                PRECISION_MIN = ALL_STEPS_DEGREES[3]; // 40cm (æ…¢è¾¹ç•Œ, Degreesè¾ƒå°)
                PRECISION_MAX = ALL_STEPS_DEGREES[4]; // 35cm (å¿«è¾¹ç•Œ, Degreesæœ€å¤§)
            } else {
                // ä¸­é—´ä¸‰ä¸ªå€¼ (57.5cm, 45cm, 40cm)
                // S+1 (æ…¢æé™): Degreesæœ€å°ï¼ŒIndex-1
                PRECISION_MIN = ALL_STEPS_DEGREES[index - 1]; 
                // S-1 (å¿«æé™): Degreesæœ€å¤§ï¼ŒIndex+1
                PRECISION_MAX = ALL_STEPS_DEGREES[index + 1]; 
            }
            // --- ç‹¬ç«‹è¾¹ç•Œå¤„ç† END ---
        }
        
        /** è®¡ç®—ç»Ÿä¸€çš„æ¯å˜ç±³åº¦æ•°å˜åŒ–åŠæ­¥é•¿ */
        function calculateUniformPerCMStep() {
            if (PRECISION_MIN === 0 || PRECISION_MAX === 0) {
                return { P_MIN_PerCM: 0, P_MAX_PerCM: 0, uniformStepChange: 0 };
            }

            const P_MIN_PerCM = toPerCM(PRECISION_MIN); 
            const P_MAX_PerCM = toPerCM(PRECISION_MAX); 
            
            const totalPerCMDiff = P_MAX_PerCM - P_MIN_PerCM;
            
            // æ•´ä¸ªåŒºé—´ (S+1 åˆ° S-1) è¢«çº¿æ€§åˆ’åˆ†ä¸º 14 ä»½ (7+7)
            const uniformStepChange = totalPerCMDiff / 14; 

            return { P_MIN_PerCM, P_MAX_PerCM, uniformStepChange };
        }


        /** è®¡ç®—çµæ•åº¦è°ƒæ•´åçš„æ–°å€¼ */
        function calculateSensitivityAdjustment(adjustmentValue) {
            if (currentDegreesFor5cm === 0) return { newDegreesFor5cm: 0, actualAdjustment: 0, adjustmentMessage: "æœªé€‰æ‹©è¿œè¿‘çº¬åº¦ã€‚", appliedMultiplier: 1.0 };

            const currentPerCM = toPerCM(currentDegreesFor5cm);
            const speedInput = adjustmentValue; // S_Input in [min, max]
            
            const { P_MIN_PerCM, P_MAX_PerCM, uniformStepChange } = calculateUniformPerCMStep();
            
            if (uniformStepChange < TOLERANCE) { // ä½¿ç”¨TOLERANCEè¿›è¡Œæµ®ç‚¹æ¯”è¾ƒ
                 return { newDegreesFor5cm: currentDegreesFor5cm, actualAdjustment: 0, adjustmentMessage: "è°ƒæ•´åŒºé—´é›¶å·®å€¼ï¼Œå·²é”å®šå½“å‰å€¼ã€‚", appliedMultiplier: 1.0 };
            }

            // PerCM_New = PerCM_Current - S_Input * Uniform Step (S_Input > 0 æ…¢, å¯¼è‡´ PerCM å‡å°)
            let newPerCM = currentPerCM - speedInput * uniformStepChange; 
            
            // æµ®ç‚¹æ•°é’³åˆ¶ï¼ˆå®‰å…¨æªæ–½ï¼‰
            newPerCM = Math.max(P_MIN_PerCM, Math.min(P_MAX_PerCM, newPerCM));
            
            const newDegreesFor5cm = toDegreesFor5cmFromPerCM(newPerCM);
            const actualAdjustment = newDegreesFor5cm - currentDegreesFor5cm;

            return {
                newDegreesFor5cm,
                actualAdjustment, 
                adjustmentMessage: "",
                appliedMultiplier: 1.0
            };
        }

        /** è®¡ç®—æ¸¸æˆçµæ•åº¦å¹¶æ›´æ–°æ˜¾ç¤º */
        function calculateGameSensitivities() {
            const dpi = parseInt(dpiInput.value) || 400; // é»˜è®¤ä½¿ç”¨ 400
            currentDpiDisplay.textContent = dpi;
            
            if (currentDegreesFor5cm === 0) {
                sensCS.textContent = 'N/A';
                sensVal.textContent = 'N/A';
                sensOW.textContent = 'N/A';
                return;
            }

            const cm360 = toCM360(currentDegreesFor5cm);
            
            if (cm360 === Infinity) {
                sensCS.textContent = 'N/A';
                sensVal.textContent = 'N/A';
                sensOW.textContent = 'N/A';
                return;
            }

            // Sensitivity = Constant / (cm360 * DPI)
            const sensCSVal = CONST_CS / (cm360 * dpi);
            const sensValVal = CONST_VAL / (cm360 * dpi);
            const sensOWVal = CONST_OW / (cm360 * dpi);
            
            // å®æ—¶æ˜¾ç¤º
            sensCS.textContent = sensCSVal.toFixed(4);
            sensVal.textContent = sensValVal.toFixed(4);
            sensOW.textContent = sensOWVal.toFixed(4);
        }

        // =========================================================================
        // C. çŠ¶æ€æ›´æ–°ä¸äº‹ä»¶å¤„ç† (æ ¸å¿ƒæ§åˆ¶)
        // =========================================================================
        
        /** æ›´æ–°åŠ¨æ€å¼ºè°ƒè‰² */
        function updateColors() {
            if (isFinalized) {
                rootElement.style.setProperty('--current-accent', 'var(--color-warning)');
                return;
            }

            const colorIndex = adjustmentCounter > 0 ? (adjustmentCounter - 1) % MAX_ADJUSTMENTS : 0;
            const colorVar = PHASE_COLORS[colorIndex] || PHASE_COLORS[0];
            rootElement.style.setProperty('--current-accent', colorVar);
        }

        /** ç»ˆç»“æµç¨‹å¹¶æ˜¾ç¤ºç»“æœ (é¢œè‰²å›ºå®šä¸ºçº¢è‰²) */
        function finalizeAdjustment(finalStatusMessage) {
            if (isFinalized) return;
            isFinalized = true;
            currentPhase = 'final';
            
            updateColors(); 
            updatePhaseDisplay();
            
            sensitivityResult.classList.add('final-result');
            document.querySelector('.main-sens-card').classList.add('finalized'); 
            
            console.log("æµç¨‹ç»“æŸ:", finalStatusMessage);
            
            // ç¡®ä¿ DPI ç­‰è®¾ç½®èƒ½å¤Ÿæ›´æ–°åˆ°æœ€ç»ˆç»“æœ
            updateDisplay(); 
        }

        /** æ›´æ–°é˜¶æ®µæ˜¾ç¤º (åŠ¨æ€åœ†ç‚¹ä¸æ»‘å—èŒƒå›´ç²¾ç¡®è®¡ç®—) */
        function updatePhaseDisplay() {
            const distancePhase = document.getElementById('distance-phase');
            const speedPhase = document.getElementById('speed-phase');
            const usabilityPhase = document.getElementById('usability-phase');
            const adjustmentControls = document.getElementById('adjustment-controls');
            const actionButtons = document.getElementById('action-buttons');
            const sliderLabels = document.querySelector('.slider-labels');
            
            distancePhase.style.display = 'none';
            speedPhase.style.display = 'none';
            usabilityPhase.style.display = 'none';
            
            if (isFinalized) {
                adjustmentControls.style.display = 'none';
                actionButtons.style.display = 'none';
                return; 
            }
            
            adjustmentControls.style.display = 'block';
            actionButtons.style.display = 'none'; 

            applyBtn.textContent = 'åº”ç”¨è°ƒæ•´';

            if (currentPhase === 'distance') {
                distancePhase.style.display = 'block'; 
                applyBtn.disabled = true; 
            } else if (currentPhase === 'speed') {
                speedPhase.style.display = 'block'; 
                actionButtons.style.display = 'flex'; 
                applyBtn.disabled = false;
                
                // åŠ¨æ€æ»‘å—èŒƒå›´è®¡ç®—
                const currentPerCM = toPerCM(currentDegreesFor5cm);
                const { P_MIN_PerCM, P_MAX_PerCM, uniformStepChange } = calculateUniformPerCMStep();

                if (uniformStepChange > TOLERANCE) {
                    
                    // 1. è®¡ç®—åˆ°å¿«æé™ (P_MAX_PerCM) çš„æµ®ç‚¹æ­¥æ•° (è´Ÿæ–¹å‘: S_Input < 0)
                    const N_Fast_float = (P_MAX_PerCM - currentPerCM) / uniformStepChange;
                    
                    // 2. è®¡ç®—åˆ°æ…¢æé™ (P_MIN_PerCM) çš„æµ®ç‚¹æ­¥æ•° (æ­£æ–¹å‘: S_Input > 0)
                    const N_Slow_float = (currentPerCM - P_MIN_PerCM) / uniformStepChange;
                    
                    // 3. ä¸¥æ ¼å››èˆäº”å…¥åˆ°æ•´æ•°æ­¥
                    let N_Fast_int = Math.round(N_Fast_float);
                    let N_Slow_int = Math.round(N_Slow_float);
                    
                    // 4. å¼ºåˆ¶æ€»æ­¥æ•°ç­‰äº 14 (åªåœ¨æµ®ç‚¹æ­¥æ•°å­˜åœ¨æ—¶è¿›è¡Œæ­¤ä¿®æ­£)
                    const total_steps = N_Fast_int + N_Slow_int;
                    if (total_steps !== 14) {
                        const correction = 14 - total_steps; 

                        // ä¼˜å…ˆè°ƒæ•´æµ®ç‚¹å€¼è¾ƒå¤§çš„é‚£ä¸ªæ–¹å‘ï¼Œä»¥ä¿æŒå››èˆäº”å…¥çš„å€¾å‘æ€§
                        if (Math.abs(N_Fast_float) > Math.abs(N_Slow_float)) {
                            N_Fast_int += correction;
                        } else {
                            N_Slow_int += correction;
                        }
                    }

                    // 5. è®¾ç½®åŠ¨æ€èŒƒå›´: Slider min (å¿«) = -N_Fast_int, Slider max (æ…¢) = +N_Slow_int
                    speedSlider.min = -N_Fast_int;
                    speedSlider.max = N_Slow_int;
                    
                    // 6. æ›´æ–°æ»‘å—æ ‡ç­¾å’Œæ˜¾ç¤ºæ–‡æœ¬
                    sliderLabels.children[0].textContent = N_Fast_int > 0 ? `å¿«æé™ (-${N_Fast_int})` : 'å·²åœ¨å¿«æé™';
                    sliderLabels.children[1].textContent = N_Slow_int > 0 ? `æ…¢æé™ (+${N_Slow_int})` : 'å·²åœ¨æ…¢æé™';
                    speedRangeDisplay.textContent = `è°ƒæ•´å¹…åº¦ [${speedSlider.min} (å¿«) è‡³ +${speedSlider.max} (æ…¢)]`;

                } else {
                    // æ— æ³•è°ƒæ•´æ—¶ï¼ŒèŒƒå›´ä¸º [0, 0]
                    speedSlider.min = 0;
                    speedSlider.max = 0;
                    sliderLabels.children[0].textContent = 'å¿«æé™';
                    sliderLabels.children[1].textContent = 'æ…¢æé™';
                    speedRangeDisplay.textContent = `è°ƒæ•´å¹…åº¦ [0 (å¿«) è‡³ +0 (æ…¢)]`;
                }
                
                // 7. ç¡®ä¿æ»‘å—åœ¨ 0 (ä»£è¡¨å½“å‰å€¼)
                speedSlider.value = 0;
                document.getElementById('speed-value').textContent = 0;
                
                document.getElementById('adjustment-count-display').textContent = `${adjustmentCounter + 1}`; 
                
            } else if (currentPhase === 'usability') {
                usabilityPhase.style.display = 'block'; 
                actionButtons.style.display = 'flex'; 
                applyBtn.disabled = false;
                applyBtn.textContent = 'ç¡®è®¤è¯„ä»·å¹¶åšå‡ºå†³ç­–';
                document.getElementById('adjustment-count-display').textContent = `${adjustmentCounter}`;
                
                // é‡ç½®è¯„ä»·æ˜Ÿçº§æ˜¾ç¤ºä¸ºé»˜è®¤ 2 æ˜Ÿ
                usabilityStars.forEach(star => {
                    star.classList.remove('active');
                    if (parseInt(star.dataset.rating) <= currentStarRating) {
                        star.classList.add('active');
                    }
                });
            }
        }


        /** æ›´æ–°å½“å‰ç•Œé¢æ‰€æœ‰æ˜¾ç¤ºæ•°å€¼ */
        function updateDisplay(isLiveUpdate = false) {
            
            let tempDegrees = currentDegreesFor5cm; 
            let tempCM360 = toCM360(currentDegreesFor5cm);

            if (currentDegreesFor5cm === 0) {
                 document.getElementById('current-base-d-step').textContent = "0.0000";
                 precisionRangeDisplay.textContent = "è¯·å…ˆé€‰æ‹©è¿œè¿‘çº¬åº¦";
                 sensitivityResult.textContent = "è¯·å…ˆé€‰æ‹©è¿œè¿‘çº¬åº¦";
                 document.getElementById('sensitivity-range').textContent = "";
                 calculateGameSensitivities();
                 return;
            }

            const { uniformStepChange } = calculateUniformPerCMStep();
            
            // **V31.0 é€»è¾‘ä¿æŒ**ï¼šæ»‘å—æ‹–åŠ¨ä¸å†å®æ—¶æ›´æ–°ä¸»æ˜¾ç¤ºåŒºåŸŸï¼Œä»…æ›´æ–°æ¸¸æˆçµæ•åº¦å’Œå•ä½åˆ‡æ¢ã€‚
            if (isLiveUpdate && currentPhase === 'speed') {
                // ä»…æ›´æ–° game sensitivitiesï¼Œä¸å½±å“ sensitivityResult
            }


            const sensitivityRange = document.getElementById('sensitivity-range');

            if (cm360UnitBtn.classList.contains('active')) {
                sensitivityResult.textContent = tempCM360.toFixed(2) + 'cm';
                let rangeHint = `[360Â°] å¯¹åº”: ${tempDegrees.toFixed(3)}Â°/5cm`;
                 if (!isLiveUpdate) {
                    if (tempDegrees < MIN_DEGREES - TOLERANCE) {
                        rangeHint += " (ä½äºç†è®ºä¸‹é™)";
                    } else if (tempDegrees > MAX_DEGREES + TOLERANCE) {
                        rangeHint += " (é«˜äºç†è®ºä¸Šé™)";
                    }
                 }
                sensitivityRange.textContent = rangeHint;
            } else { // cm5UnitBtn is active
                sensitivityResult.textContent = tempDegrees.toFixed(3) + 'Â°';
                let rangeHint = `[5cm] å¯¹åº”: ${tempCM360.toFixed(2)}cm/360Â°`;
                 if (!isLiveUpdate) {
                    if (tempDegrees < MIN_DEGREES - TOLERANCE) {
                        rangeHint += " (ä½äºç†è®ºä¸‹é™)";
                    } else if (tempDegrees > MAX_DEGREES + TOLERANCE) {
                        rangeHint += " (é«˜äºç†è®ºä¸Šé™)";
                    }
                 }
                sensitivityRange.textContent = rangeHint;
            }

            document.getElementById('current-base-d-step').textContent = uniformStepChange.toFixed(4); 
            
            // PRECISION_MIN (æ…¢æé™ S+1): Degreesæœ€å°, CM360æœ€å¤§ (MaxCM)
            // PRECISION_MAX (å¿«æé™ S-1): Degreesæœ€å¤§, CM360æœ€å° (MinCM)
            const min_cm360 = toCM360(PRECISION_MAX); 
            const max_cm360 = toCM360(PRECISION_MIN); 

            precisionRangeDisplay.textContent = `[${max_cm360.toFixed(2)}cm åˆ° ${min_cm360.toFixed(2)}cm]`;
            
            // åªæœ‰åœ¨éå®æ—¶æ›´æ–°æ—¶ï¼ˆå³åº”ç”¨/é‡ç½®/è·ç¦»/å•ä½/DPIæ›´æ”¹ï¼‰ï¼Œæ‰æ›´æ–°æ¸¸æˆçµæ•åº¦
            if (!isLiveUpdate) {
               calculateGameSensitivities();
            }
        }
        
        /** åº”ç”¨çµæ•åº¦è°ƒæ•´ (ä¸­å¤®çŠ¶æ€æœº) */
        function applySensitivityAdjustment() {
            if (isFinalized) {
                finalizeAdjustment('æµç¨‹å·²é”å®š');
                return;
            }
            
            if (currentPhase === 'speed') {
                
                const speedInput = parseInt(speedSlider.value);
                
                // V29.0 æ ¸å¿ƒé€»è¾‘: é›¶å¹…åº¦è°ƒæ•´å³é”å®š 
                if (speedInput === 0) {
                    const finalCM360 = toCM360(currentDegreesFor5cm).toFixed(2);
                    finalizeAdjustment(`æ‚¨é€‰æ‹©äº†é›¶å¹…åº¦è°ƒæ•´ (${speedInput}) å¹¶ç‚¹å‡»äº†â€œåº”ç”¨è°ƒæ•´â€ï¼Œç³»ç»Ÿåˆ¤å®šæ‚¨çš„æ„å›¾æ˜ç¡®ï¼šä¿æŒå½“å‰çµæ•åº¦ï¼Œæµç¨‹ç«‹å³ç»ˆç»“ï¼Œå¹¶é”å®šæœ€ç»ˆçµæ•åº¦ (${finalCM360}cm/360Â°)ã€‚`);
                    return; 
                }

                const result = calculateSensitivityAdjustment(speedInput);
                const newDegreesFor5cm = result.newDegreesFor5cm; 

                const minVal = parseInt(speedSlider.min);
                const maxVal = parseInt(speedSlider.max);
                
                // V27.0 æ ¸å¿ƒé€»è¾‘: è¾¹ç•Œå€¼åº”ç”¨æ—¶é”å®š
                if (speedInput === minVal || speedInput === maxVal) {
                    currentDegreesFor5cm = newDegreesFor5cm; // é”å®šæœ€ç»ˆå€¼
                    const finalCM360 = toCM360(currentDegreesFor5cm).toFixed(2);
                    const limitType = speedInput === minVal ? 'å¿«æé™' : 'æ…¢æé™';
                    const finalMsg = `æ‚¨å°†æ»‘æ†è°ƒæ•´è‡³${limitType}å¹¶ç‚¹å‡»äº†â€œåº”ç”¨è°ƒæ•´â€ï¼Œç³»ç»Ÿåˆ¤å®šæ‚¨çš„æ„å›¾æ˜ç¡®ï¼Œæµç¨‹ç«‹å³ç»ˆç»“ï¼Œå¹¶é”å®šæœ€ç»ˆçµæ•åº¦ (${finalCM360}cm/360Â°)ã€‚`;
                    finalizeAdjustment(finalMsg);
                    return; 
                }
                
                currentDegreesFor5cm = newDegreesFor5cm; 
                
                // V28.0 æ ¸å¿ƒé€»è¾‘: è°ƒæ•´æ¬¡æ•°ç²¾ç¡®é™åˆ¶ 
                adjustmentCounter++; // å…ˆè‡ªå¢ï¼Œè®°å½•å·²å®Œæˆçš„è°ƒæ•´æ¬¡æ•° (1, 2)

                if (adjustmentCounter >= MAX_ADJUSTMENTS) { 
                    const finalCM360 = toCM360(currentDegreesFor5cm).toFixed(2);
                    finalizeAdjustment(`äºŒæ¬¡å¿«æ…¢è°ƒæ•´ï¼ˆç¬¬ ${MAX_ADJUSTMENTS} è½®ï¼‰å·²å®Œæˆã€‚ç³»ç»Ÿåˆ¤å®šè°ƒæ•´æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼Œæµç¨‹å¼ºåˆ¶ç»ˆç»“ï¼Œå¹¶é”å®šæœ€ç»ˆçµæ•åº¦ (${finalCM360}cm/360Â°)ã€‚`);
                    return; // ç»“æŸç¬¬ 2 æ¬¡è°ƒæ•´åçš„å¾ªç¯
                }
                
                if (adjustmentCounter === 1) { 
                    currentPhase = 'usability';
                } 

            } else if (currentPhase === 'usability') {
                
                const rating = currentStarRating;
                
                if (rating === 3) {
                    const finalCM360 = toCM360(currentDegreesFor5cm).toFixed(2);
                    finalizeAdjustment(`æ‚¨é€‰æ‹©äº† 3 æ˜Ÿè¯„ä»·ï¼Œç³»ç»Ÿå·²é”å®šå½“å‰çµæ•åº¦ (${finalCM360}cm/360Â°) ä¸ºæœ€ç»ˆç»“æœã€‚`);
                    return; 
                    
                } else if (rating === 1) {
                    console.log("æ‚¨é€‰æ‹©äº† 1 æ˜Ÿè¯„ä»·ï¼Œç³»ç»Ÿå°†åˆå§‹åŒ–æ‰€æœ‰å‚æ•°ã€‚");
                    setTimeout(resetAll, 50); 
                    return;
                    
                } else if (rating === 2) {
                    // AC=1 (ç¬¬ä¸€è½®è°ƒæ•´å) -> Rating 2 -> ç»§ç»­ç¬¬äºŒè½®æ‹‰æ†è°ƒæ•´
                    currentPhase = 'speed'; 
                    currentStarRating = 2; 
                }
            }
            
            // åœ¨åº”ç”¨è°ƒæ•´åï¼Œå¼ºåˆ¶æ›´æ–°æ‰€æœ‰æ˜¾ç¤º
            updateDisplay(); 
            updatePhaseDisplay();
            updateColors(); 
        }
        
        function resetAll() {
            currentDegreesFor5cm = 0; 
            adjustmentCounter = 0;
            currentStarRating = 2; 
            isFinalized = false;
            currentPhase = 'distance';
            
            PRECISION_MIN = MIN_DEGREES; 
            PRECISION_MAX = MAX_DEGREES;

            applyBtn.disabled = true;
            sensitivityResult.classList.remove('final-result');
            document.querySelector('.main-sens-card').classList.remove('finalized'); 

            distanceButtons.forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('active');
            });
            usabilityStars.forEach(star => {
                star.classList.remove('active');
                if (parseInt(star.dataset.rating) === 2) {
                    star.classList.add('active');
                }
            });
            
            cm5UnitBtn.classList.remove('active');
            cm360UnitBtn.classList.add('active'); 
            
            dpiInput.value = 400; 
            speedSlider.value = 0; 
            document.getElementById('speed-value').textContent = 0;

            // é‡ç½®åŠ¨æ€èŒƒå›´æ˜¾ç¤º
            speedSlider.min = -7;
            speedSlider.max = 7;
            document.querySelector('.slider-labels').children[0].textContent = 'å¿«æé™';
            document.querySelector('.slider-labels').children[1].textContent = 'æ…¢æé™';
            speedRangeDisplay.textContent = 'è°ƒæ•´å¹…åº¦ [åŠ¨æ€èŒƒå›´]';


            updateDisplay();
            updatePhaseDisplay();
            updateColors(); 
        }
        
        // =========================================================================
        // D. äº‹ä»¶ç»‘å®š 
        // =========================================================================

        distanceButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                if (currentPhase !== 'distance' || isFinalized) return;
                
                const cm360_value = parseFloat(this.dataset.value);
                const degrees_value = toDegreesFor5cm(cm360_value);

                currentDegreesFor5cm = degrees_value;
                
                setHardPrecisionBounds(degrees_value);

                distanceButtons.forEach(b => {
                    b.classList.remove('active');
                    b.disabled = true; 
                });
                this.classList.add('active');

                currentPhase = 'speed';
                
                updateDisplay();
                updatePhaseDisplay(); 
                updateColors(); 
            });
        });
        
        usabilityStars.forEach(star => {
            star.addEventListener('click', function() {
                if (currentPhase !== 'usability' || isFinalized) return;

                const rating = parseInt(this.dataset.rating);
                currentStarRating = rating;
                
                usabilityStars.forEach(s => {
                    s.classList.remove('active');
                    if (parseInt(s.dataset.rating) <= rating) {
                        s.classList.add('active');
                    }
                });
            });
        });
        
        speedSlider.addEventListener('input', function() {
            const val = parseInt(this.value);

            document.getElementById('speed-value').textContent = val;
            applyBtn.disabled = false; // åªè¦æ»‘åŠ¨äº†ï¼Œå°±å¯ä»¥åº”ç”¨
            
            // V31.0 é€»è¾‘ä¿æŒ: ç§»é™¤ updateDisplay(true); ä»¥åœæ­¢æ»‘æ†çš„å®æ—¶ç›‘æµ‹æ›´æ–°
        });

        cm360UnitBtn.addEventListener('click', function() {
            if (!this.classList.contains('active')) {
                this.classList.add('active');
                cm5UnitBtn.classList.remove('active');
                updateDisplay();
            }
        });
        
        cm5UnitBtn.addEventListener('click', function() {
            if (!this.classList.contains('active')) {
                this.classList.add('active');
                cm360UnitBtn.classList.remove('active');
                updateDisplay();
            }
        });
        
        // DPI å˜åŒ–æ—¶ï¼Œä»ç„¶éœ€è¦æ›´æ–°æ˜¾ç¤ºï¼ˆæ˜¾ç¤ºå½“å‰çš„çµæ•åº¦å€¼å’Œæ¸¸æˆæ¢ç®—å€¼ï¼‰
        dpiInput.addEventListener('input', updateDisplay);

        applyBtn.addEventListener('click', applySensitivityAdjustment);
        document.getElementById('reset-btn').addEventListener('click', resetAll);
        
        // åˆå§‹åŒ–è°ƒç”¨
        resetAll(); 
    </script>
</body>
</html>