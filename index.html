<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¥¿å²›æµ· Â· ä¸‰é˜¶æ ¡å‡†æ³•</title>
    <link rel="icon" href="https://xidaohai.github.io/miaozhun.ico" type="image/x-icon">
    
    <style>
        :root {
            --bg-body: #1a1a2a;
            --bg-card: #252535;
            --bg-card-hover: #2d2d3d;
            --border-color: #3a3a4a;
            
            --primary: #4a90e2;
            --primary-hover: #3a80d2;
            --accent: #5bc0de;
            
            --text-main: #e0e0f0;
            --text-sub: #b0b0c0;
            --text-muted: #8a8a9a;
            
            --success: #1abc9c;
            --warning: #f1c40f;
            
            --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-float: 0 8px 25px rgba(0, 0, 0, 0.4);
            --shadow-nav: 0 4px 15px rgba(0, 0, 0, 0.3);
            
            --history-p1: #60a5fa;
            --history-p2: #34d399;
            --history-p3: #f59e0b;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            padding-top: 70px;
        }
        
        @media (max-width: 900px) {
            body {
                padding-top: 50px;
            }
        }

        /* èƒŒæ™¯çº¹ç†å±‚ */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100" opacity="0.03"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="45" fill="none" stroke="white" stroke-width="0.5"/><circle cx="20" cy="20" r="5" fill="white"/><circle cx="80" cy="80" r="5" fill="white"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
            z-index: 0;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-hover);
        }

        /* --- é¡¶éƒ¨å¯¼èˆªæ  --- */
        .top-navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70px;
            background: rgba(26, 26, 42, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(58, 58, 74, 0.5);
            display: flex;
            align-items: center;
            z-index: 2000;
            box-shadow: var(--shadow-nav);
            padding: 0 20px;
        }

        .nav-logo {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
            margin-right: 20px;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }

        .nav-logo::before {
            content: "ğŸ¯";
            margin-right: 8px;
            font-size: 1.2rem;
        }

        /* æ»šåŠ¨å®¹å™¨åŒ…è£¹é“¾æ¥ */
        .nav-scroll-container {
            flex: 1;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
            -ms-overflow-style: none;
            height: 100%;
            display: flex;
            align-items: center;
        }
        .nav-scroll-container::-webkit-scrollbar { display: none; }

        .nav-links {
            display: flex;
            gap: 10px;
            align-items: center;
            padding: 0 5px;
        }

        .nav-item {
            color: var(--text-sub);
            text-decoration: none;
            font-size: 0.85rem;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.25s ease;
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            white-space: nowrap;
        }
        
        .nav-item span.emoji {
            margin-right: 5px;
            font-size: 1rem;
        }

        .nav-item:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        /* é‡ç‚¹çªå‡ºçš„å¯¼èˆªé¡¹ */
        .nav-item.highlight {
            color: var(--warning);
            font-weight: 500;
        }

        /* ä¸‹è½½æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .download-btn { 
            display: inline-flex; 
            align-items: center;
            background: #d97706;
            color: white; 
            padding: 8px 16px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-size: 0.85rem; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); 
            transition: all 0.2s; 
            margin-left: 10px; 
        }
        .download-btn:hover { 
            transform: translateY(-2px); 
            background: #b45309; 
            box-shadow: 0 6px 10px rgba(0,0,0,0.25); 
        }

        /* --- ä¸»å¸ƒå±€ --- */
        .layout-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 25px;
            position: relative;
            z-index: 1;
        }
        
        /* æ‚¬æµ®çª—å®šä½ (PCç«¯) */
        @media (min-width: 1201px) {
            .float-fixed-left { position: fixed; bottom: 20px; left: 20px; width: 260px; z-index: 100; }
            .float-fixed-right { position: fixed; bottom: 20px; right: 20px; z-index: 100; }
            
            .float-fixed-left-top { position: fixed; top: 90px; left: 20px; width: 240px; z-index: 90; }
            .float-fixed-right-top { position: fixed; top: 90px; right: 20px; width: 220px; z-index: 90; }
        }
        
        /* æ‰‹æœºç«¯é€‚é…ï¼šå˜ä¸ºå•åˆ— */
        @media (max-width: 900px) {
            .layout-container { 
                grid-template-columns: 1fr; 
                padding: 15px;
                gap: 15px;
            }
            
            /* æ‰‹æœºç«¯ç®€åŒ–å¯¼èˆªæ  */
            .top-navbar {
                height: 50px;
                padding: 0 15px;
            }
            .nav-logo {
                font-size: 1rem;
                margin-right: 10px;
            }
            
            /* æ‰‹æœºç«¯éšè—é¡¶éƒ¨çš„é“¾æ¥ */
            .top-navbar .nav-links {
                display: none;
            }

            /* é‡æ–°å¯ç”¨æ‰‹æœºç«¯çš„å¯¼èˆªé“¾æ¥ (å¾€ä¸‹æ’) */
            .mobile-nav-links-card {
                display: block !important;
            }
            .mobile-nav-links-card .nav-links {
                display: flex;
                flex-direction: column;
                gap: 5px;
                width: 100%;
            }
            
            /* æ‰‹æœºç«¯é€‚é…ï¼šå°†éœ€è¦çš„æ‚¬æµ®çª—å˜ä¸ºæµå¼å¸ƒå±€ */
            .float-fixed-left,
            .float-fixed-right-top,
            .float-fixed-right,
            .float-fixed-left-top {
                position: static !important; 
                width: 100% !important;
                margin: 15px auto 0 !important;
                display: block !important;
                box-shadow: var(--shadow-card) !important; 
            }
            
            /* ç¡®ä¿å†å²è®°å½•åœ¨æ‰‹æœºç«¯æ˜¯æµå¼å¸ƒå±€ */
            .history-panel {
                position: static;
                max-height: none;
                order: 1;
                margin-top: 25px !important;
            }

            /* ç¡®ä¿é¡ºåº */
            .float-fixed-left { order: 2; }
            .float-fixed-right-top { order: 3; }
            .float-fixed-right { order: 4; }
            .float-fixed-left-top { order: 5; }

            /* æ‰‹æœºç«¯åŸºå‡†å€¼ç½®é¡¶ */
            .current-base-column { order: -1; }
            
            /* æ‰‹æœºç«¯æ’­æ”¾å™¨è°ƒæ•´ */
            .audio-player-container {
                bottom: 10px !important;
                right: 10px !important;
                width: 100%;
                max-width: none;
            }
            .audio-player-panel {
                width: 100%;
                border-radius: 8px;
            }
        }
        
        /* æ‰‹æœºç«¯ä¸‹æ’é“¾æ¥å¡ç‰‡æ ·å¼ (é»˜è®¤éšè—) */
        .mobile-nav-links-card {
            display: none; 
            margin-top: 25px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto 20px;
        }

        /* --- ä¸“ä¸šå¡ç‰‡æ ·å¼ --- */
        .pro-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-card);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .pro-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .pro-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        /* --- é˜¶æ®µåˆ‡æ¢ Tabs --- */
        .phase-tabs {
            display: flex; 
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 4px;
            border-radius: 8px;
            margin-bottom: 24px;
            gap: 4px;
        }

        .phase-tab {
            padding: 10px 0;
            text-align: center;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            text-decoration: none;
            white-space: nowrap;
        }

        /* é’ˆå¯¹å®é™… Phase Button çš„æ ·å¼ */
        .phase-tabs button.phase-tab {
            flex: 1;
        }

        /* é’ˆå¯¹æ–°çš„ SD Link/Tab æ ·å¼ */
        .sd-tab {
            flex-grow: 0; 
            flex-shrink: 0;
            padding: 10px 15px; 
            color: var(--warning);
        }
        .sd-tab:hover {
            color: white;
            background: rgba(241, 196, 15, 0.2);
        }

        .phase-tab.active {
            background: var(--bg-card-hover);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* --- æç¤ºæ¡† (Note) --- */
        .phase-note {
            background: rgba(74, 144, 226, 0.08);
            border-left: 4px solid var(--primary);
            padding: 16px;
            margin-bottom: 24px;
            border-radius: 0 6px 6px 0;
            font-size: 0.9rem;
            color: var(--text-sub);
        }
        
        .phase-note strong { color: var(--text-main); display: block; margin-bottom: 4px; }

        /* --- è¾“å…¥æ¡†ä¸æŒ‰é’® --- */
        .input-wrapper {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        input[type="number"] {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            width: 100%;
            font-size: 1rem;
            font-family: inherit;
            transition: border 0.2s, box-shadow 0.2s;
        }
        
        /* --- æ¸¸æˆç±»å‹ Custom Select æ ·å¼ --- */
        .custom-select-wrapper {
            position: relative;
            display: block;
            width: 100%;
            background: rgba(0, 0, 0, 0.4); 
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .custom-select-wrapper:focus-within {
             border-color: var(--primary);
             box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        .custom-select-wrapper select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: transparent;
            border: none; 
            padding: 10px 30px 10px 14px; 
            width: 100%;
            color: var(--text-main);
            font-size: 1rem;
            cursor: pointer;
            outline: none;
            font-family: inherit;
            box-shadow: none;
        }
        
        .custom-select-wrapper select option {
            background-color: var(--bg-card);
            color: var(--text-main);
            padding: 8px 14px;
        }

        .custom-select-wrapper::after {
            content: 'â–¼';
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 0.7rem;
            pointer-events: none; 
            transition: color 0.2s;
        }

        .custom-select-wrapper:hover::after {
            color: var(--primary);
        }
        
        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }

        button.btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        button.btn-primary:hover { 
            background: var(--primary-hover); 
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        button.btn-action {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        button.btn-action:hover { 
            background: var(--primary); 
            border-color: var(--primary); 
            transform: translateY(-1px);
        }

        /* --- æ ¸å¿ƒæ•°å€¼ç½‘æ ¼ --- */
        .value-grid {
            display: grid;
            grid-template-columns: 1fr 240px 1fr;
            gap: 20px;
            align-items: start;
        }

        @media (max-width: 768px) {
            .value-grid { grid-template-columns: 1fr; gap: 15px; }
            .current-base-column { order: -1; }
        }

        .value-box {
            background: rgba(0,0,0,0.15);
            border: 1px solid transparent;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, border-color 0.2s;
            position: relative;
        }
        .value-box:hover { border-color: rgba(255,255,255,0.1); }

        .value-title { 
            font-size: 0.9rem; 
            color: var(--text-muted); 
            margin-bottom: 10px; 
            font-weight: 600; 
        }
        .cm-value { 
            font-size: 1.8rem; 
            font-weight: 700; 
            color: var(--text-main); 
            margin: 8px 0; 
            font-variant-numeric: tabular-nums; 
        }
        
        .sens-list {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-align: left;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 6px;
            line-height: 1.6;
            margin-top: 10px;
        }
        
        .sens-list strong { color: var(--text-main); }
        .sens-list span { color: var(--accent); font-weight: 500; font-variant-numeric: tabular-nums; }
        
        /* åŸºå‡†å€¼é«˜äº® */
        .current-base-box {
            border: 2px solid var(--primary);
            background: rgba(74, 144, 226, 0.05);
            padding: 24px 20px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow-float);
        }

        .current-base-column .value-title { color: var(--primary); }
        
        /* æ ¸å¿ƒæ•°å€¼ä¿¡æ¯ */
        .value-info {
            font-size: 0.8rem;
            color: var(--text-sub);
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed rgba(255,255,255,0.1);
        }
        
        .value-info strong {
            color: var(--primary);
            font-weight: 600;
        }

        /* å…¬å¼æ¨å¯¼åŒºåŸŸ */
        .derivation-box {
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--text-sub);
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .derivation-title {
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 8px;
            border-bottom: 1px dashed rgba(255,255,255,0.1);
            padding-bottom: 5px;
        }
        
        .formula {
            font-family: 'Courier New', Courier, monospace;
            color: var(--accent);
            display: block;
            margin-top: 5px;
        }

        /* æœ€ç»ˆç»“æœæ˜¾ç¤º */
        #finalResult {
            margin-top: 25px;
            padding: 20px;
            background: var(--success);
            color: white;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(26, 188, 156, 0.4);
            display: none;
        }
        #finalResult strong { display: block; font-size: 2.2rem; margin-top: 5px; }

        /* --- æ–°å¢ï¼šå…¬å¼å±•ç¤ºæ¡ --- */
        .formula-bar {
            background: var(--bg-card-hover);
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            margin-top: 25px;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .formula-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--primary);
            white-space: nowrap;
            margin-right: 15px;
        }

        .formula-content {
            flex-grow: 1;
            text-align: right;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.1rem;
            font-weight: 700;
            /* è°ƒæ•´é¢œè‰²ï¼šä» --accent æ”¹ä¸º --text-subï¼Œä½¿å…¶æ›´æ·¡æ›´æŸ”å’Œ */
            color: var(--text-sub); 
        }

        @media (max-width: 600px) {
            .formula-bar {
                flex-direction: column;
                align-items: flex-start;
            }
            .formula-content {
                text-align: left;
                margin-top: 8px;
            }
        }
        
        /* --- è¾…åŠ©å·¥å…·å¡ç‰‡æ ·å¼ --- */
        .widget-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 18px;
            box-shadow: var(--shadow-card);
            transition: box-shadow 0.3s;
        }
        .widget-card:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .widget-header { 
            font-size: 0.9rem; 
            font-weight: 600; 
            color: var(--primary); 
            margin-bottom: 12px; 
            padding-bottom: 8px; 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
        }

        /* ä½œè€…ä¿¡æ¯æ ·å¼ */
        .author-info {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 6px 16px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-float);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            flex-wrap: wrap; 
        }
        
        .author-link { 
            color: var(--text-sub); 
            text-decoration: none; 
            font-size: 0.85rem; 
            transition: color 0.2s; 
            white-space: nowrap;
        }
        .author-link:hover { color: var(--primary); }
        
        /* ä½œè€…åˆ†å‰²çº¿ */
        .author-info .separator {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin: 0 -2px;
        }

        /* æèµ æŒ‰é’®æ ·å¼ */
        .donate-btn {
            width: 36px;
            height: 36px;
            background: #f87171;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(248, 113, 113, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            margin-left: auto; 
        }
        .donate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(248, 113, 113, 0.5);
        }

        /* --- å†å²è®°å½• --- */
        .history-panel {
            position: sticky;
            top: 90px;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
        }
        
        .history-panel .widget-header { 
            padding-bottom: 0; 
            border-bottom: none;
            margin-bottom: 0;
            color: var(--text-main);
            font-size: 1.1rem;
            font-weight: 700;
        }

        .history-item {
            margin-bottom: 8px;
            padding: 10px 12px;
            background: rgba(255,255,255,0.03);
            border-left: 3px solid var(--border-color);
            border-radius: 0 4px 4px 0;
            font-size: 0.85rem;
            color: var(--text-sub);
        }
        
        .history-item.phase-1 { border-color: var(--history-p1); }
        .history-item.phase-2 { border-color: var(--history-p2); }
        .history-item.phase-3 { border-color: var(--history-p3); }
        .history-panel.pro-card { margin-bottom: 0; padding-top: 15px; }
        
        /* --- æ–°å¢ï¼šéŸ³ä¹æ’­æ”¾å™¨æ ·å¼ --- */
        .audio-player-container {
            position: fixed;
            bottom: 80px; /* é¿å¼€ä½œè€…ä¿¡æ¯å¡ç‰‡ */
            right: 20px;
            z-index: 1000;
            max-width: 250px;
            transition: all 0.3s ease;
        }

        .audio-player-panel {
            background: var(--bg-card-hover);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 10px 15px;
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            user-select: none;
        }
        
        .audio-player-panel .track-info {
            font-size: 0.85rem;
            color: var(--text-sub);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 1;
        }
        
        .audio-player-panel .play-pause-btn {
            background: var(--primary);
            border: none;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
            flex-shrink: 0;
        }

        .audio-player-panel .play-pause-btn:hover {
            background: var(--primary-hover);
        }
        
        .audio-player-panel .play-pause-btn:active {
            transform: scale(0.95);
        }
        
        /* ä½¿ç”¨ SVG å›¾æ ‡æ¨¡æ‹Ÿ */
        .audio-player-panel .icon {
            color: white;
            font-size: 1.1rem;
            line-height: 1;
        }
        
        .audio-player-panel .icon.play::after {
            content: 'â–¶'; /* æ’­æ”¾ä¸‰è§’å½¢ */
            margin-left: 2px; /* è°ƒæ•´è§†è§‰ä¸­å¿ƒ */
        }
        
        .audio-player-panel .icon.pause::after {
            content: 'â¸'; /* æš‚åœåŒç«–çº¿ */
        }

        /* éšè—åŸç”Ÿçš„audioå…ƒç´  */
        .audio-player-container audio {
            display: none;
        }
        
    </style>
</head>
<body>

    <div id="welcomeModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; opacity: 0; pointer-events: none;">
        <div style="background: var(--bg-card); padding: 30px; border-radius: 12px; max-width: 400px; text-align: center; border: 1px solid var(--primary); box-shadow: var(--shadow-float);">
            <h2 style="color: var(--primary); margin-bottom: 15px;">æ¬¢è¿ä½¿ç”¨ ä¸‰é˜¶æ ¡å‡†æ³•</h2>
            <p style="color: var(--text-sub); line-height: 1.8; margin-bottom: 20px;">
æ ¡å‡†æ—¶æœ€å¥½æ‰¾ä¸€ä¸ªæ··åˆçš„æ¸¸æˆåœºæ™¯ã€‚å¼€å§‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²çŸ¥æ‚‰ <a href="https://www.bilibili.com/video/BV1Qr2xBVEy2" target="_blank" style="color: var(--accent); text-decoration: none; font-weight: bold;">ä½¿ç”¨æ•™ç¨‹</a>ã€‚
            </p>
            <p style="color: var(--text-sub); font-size: 0.85rem; margin-bottom: 20px;">
                å½“å‰æ¸¸æˆ DPI ä¸º <span class="current-dpi-display" style="color: var(--warning); font-weight: bold;">400</span>ã€‚è¯·å…ˆæ³¨æ„ å·¦ä¸‹è§’ è½¬æ¢åå†ä»¥ å¾—æ•° æ ¡å‡†ã€‚
            </p>
            <button class="btn-primary" id="closeModalBtn">æˆ‘å·²çŸ¥æ‚‰å¹¶ç»§ç»­</button>
        </div>
    </div>

    <nav class="top-navbar">
        <div class="nav-logo">ä¸‰é˜¶æ ¡å‡†æ³•</div>
        <div class="nav-scroll-container">
            <div class="nav-links">
                <a href="https://www.bilibili.com/video/BV1Qr2xBVEy2" target="_blank" class="nav-item highlight"><span class="emoji">ğŸ¬</span>æ•™ç¨‹</a>
                <a href="/dg.pdf" class="nav-item"><span class="emoji">ğŸ“•</span>ä¸‰é˜¶å¤§çº²</a>
                <a href="/dpi.zip" class="nav-item"><span class="emoji">ğŸ–±ï¸</span>çœŸå®DPI</a>
                <a href="/jyslf.html" class="nav-item"><span class="emoji">ğŸ§²</span>è®°å¿†æ”¶æ•›æ³•ï¼ˆå¿«åˆ†æ³•ï¼‰</a>
                <a href="/bdf.html" class="nav-item"><span class="emoji">ğŸ“œ</span>è¡¨è¾¾æ³•</a>
                <a href="/gjjz.html" class="nav-item"><span class="emoji">ğŸ› ï¸</span>è¡¨è¾¾æ³•Â·æ ¡å‡†</a>
                <a href="/zgf.html" class="nav-item"><span class="emoji">â•</span>æ­£æ”¹æ³•</a>
                <a href="/huan.txt" class="nav-item"><span class="emoji">ğŸ”„</span>æ¢è®¾å¤‡åè¿˜åŸæ‰‹æ„Ÿ</a>
                <a href="/cf.txt" class="nav-item"><span class="emoji"></span>CFæ•æ€ä¹ˆè°ƒ</a>
                <a href="/mzxl.html" class="nav-item"><span class="emoji">ğŸ¯</span>ç„å‡†æ¸…å•</a>
                <a href="/dfjsq.html" class="nav-item"><span class="emoji"></span>å¥åº·</a>
                <a href="/js.txt" class="nav-item"><span class="emoji"></span>ä½œè€…ä»‹ç»</a>
                <a href="/jsmv.mp4" class="nav-item"><span class="emoji"></span>ä½œè€…MV</a>
                <a href="https://wwpx.lanzouu.com/iPdqd3b79yuf" target="_blank" class="download-btn">
                    <span class="emoji">â¬‡ï¸</span>åŸºåº•æ‹Ÿåˆv4ä¸‹è½½ 
                </a>
            </div>
        </div>
    </nav>

    <div class="layout-container">
        <main>
            <div class="pro-card mobile-nav-links-card">
                 <div class="nav-links">
                <a href="https://www.bilibili.com/video/BV1Qr2xBVEy2" target="_blank" class="nav-item highlight"><span class="emoji">ğŸ¬</span>æ•™ç¨‹</a>
                <a href="/dg.pdf" class="nav-item"><span class="emoji">ğŸ“•</span>ä¸‰é˜¶å¤§çº²</a>
                <a href="/dpi.zip" class="nav-item"><span class="emoji">ğŸ–±ï¸</span>çœŸå®DPI</a>
                <a href="/jyslf.html" class="nav-item"><span class="emoji">ğŸ§²</span>è®°å¿†æ”¶æ•›æ³•ï¼ˆå¿«åˆ†æ³•ï¼‰</a>
                <a href="/bdf.html" class="nav-item"><span class="emoji">ğŸ“œ</span>è¡¨è¾¾æ³•</a>
                <a href="/gjjz.html" class="nav-item"><span class="emoji">ğŸ› ï¸</span>è¡¨è¾¾æ³•Â·æ ¡å‡†</a>
                <a href="/zgf.html" class="nav-item"><span class="emoji">â•</span>æ­£æ”¹æ³•</a>
                <a href="/huan.txt" class="nav-item"><span class="emoji">ğŸ”„</span>æ¢è®¾å¤‡åè¿˜åŸæ‰‹æ„Ÿ</a>
                <a href="/cf.txt" class="nav-item"><span class="emoji"></span>CFæ•æ€ä¹ˆè°ƒ</a>
                <a href="/mzxl.html" class="nav-item"><span class="emoji">ğŸ¯</span>ç„å‡†æ¸…å•</a>
                <a href="/dfjsq.html" class="nav-item"><span class="emoji"></span>å¥åº·</a>
                <a href="/js.txt" class="nav-item"><span class="emoji"></span>ä½œè€…ä»‹ç»</a>
                <a href="/jsmv.mp4" class="nav-item"><span class="emoji"></span>ä½œè€…MV</a>
                <a href="https://wwpx.lanzouu.com/iPdqd3b79yuf" target="_blank" class="download-btn">
                    <span class="emoji">â¬‡ï¸</span>åŸºåº•æ‹Ÿåˆv4ä¸‹è½½ 
                    </a>
                </div>
            </div>
            
            <div class="pro-card main-box" id="mainBox">
                <div class="phase-tabs">
                    <a href="/sd.html" class="phase-tab sd-tab">âš¡ é—ªç”µç®—</a>
                    <button class="phase-tab active" id="switchPhase1Btn">â…  åˆé˜¶Â·æ¡†å¤§æ•</button>
                    <button class="phase-tab" id="switchPhase2Btn">â…¡ äºŒé˜¶Â·å‹å¿«æ•</button>
                    <button class="phase-tab" id="switchPhase3Btn">â…¢ ä¸‰é˜¶Â·æ‹”æ…¢æ•</button>
                </div>
                
                <div id="initialSetup">
                    <div style="margin-bottom: 10px; color: var(--text-sub);"> 
                        ã€è¯·å¡«å…¥å·¦ä¸‹è§’ã€‘ç”±æ‚¨å¸¸ç”¨çš„ æ¸¸æˆçµæ•åº¦ è½¬æ¢åçš„ <strong>cm/360Â°</strong> æ•°å€¼: 
                    </div>
                    <div class="input-wrapper">
                        <input type="number" id="inputCm" step="0.1" placeholder="ä¾‹å¦‚: 40">
                        <button class="btn-primary" id="startCalibrationBtn">å¼€å§‹æ ¡å‡†</button>
                    </div>
                </div>
                
                <div id="phase1Note" class="phase-note" style="display: none;">
                    <strong>é˜¶æ®µ I æç¤ºï¼šåœ¨ç¬¬ä¸€é˜¶æ®µè¯·å–„ç”¨ å·¦ä¾§çš„ä¿®æ”¹åŸºå‡†å€¼ã€æœ€å¥½ç”¨é—ªç”µç®—ä»£æ›¿ç¬¬ä¸€é˜¶æ®µã€‘</strong>
                    <div>è¿›å…¥ç¬¬äºŒé˜¶æ®µçš„æ¡ä»¶ï¼š</div>
                    1. å½“åå¤å‡ºç°åŒä¸€åŸºå‡†å€¼æ—¶ï¼ˆå°±æ˜¯è§‰å¾—åŸºå‡†å€¼é¡ºæ‰‹æ—¶ï¼‰<br>
                    2. å½“é€‰æ‹©å˜å¾—å›°éš¾æ—¶ [ä»¥æ­¤ä¸ºä¸»]
                </div>
                
                <div id="phase2Note" class="phase-note" style="display: none;">
                    <strong>é˜¶æ®µ II æç¤ºï¼šå‹å¿«æ•</strong>
                    <div>è¿›å…¥ç¬¬ä¸‰é˜¶æ®µçš„æ¡ä»¶ï¼š</div>
                    1. å½“åå¤å‡ºç°åŒä¸€åŸºå‡†å€¼æ—¶ [ä»¥æ­¤ä¸ºä¸»]<br>
                    2. å½“é€‰æ‹©å˜å¾—å›°éš¾æ—¶
                </div>
                
                <div id="phase3Note" class="phase-note" style="display: none;">
                    <strong>é˜¶æ®µ III æç¤ºï¼šæ‹”æ…¢æ•</strong>
                    <div style="color: var(--warning);">âš ï¸ æ³¨æ„ï¼šè¯·ç”¨ã€å³ä¸Šè§’ä¸¤ä¸ªå…¬å¼ã€‘ï¼Œæ¥æ ¸å¯¹æ­¤æœ€ç»ˆç»“æœ</div>
                    <div>æœ€ç»ˆä¼˜åŒ–é˜¶æ®µï¼š</div>
                    è¯·å…ˆè‡³å°‘åœ¨æ­¤é˜¶æ®µé€‰æ‹©ä¸‰æ¬¡ï¼Œå†ä½¿ç”¨å…¬å¼æ ¸å¯¹æœ€ç»ˆç»“æœï¼Œ[Â±4cmä¸ç®—æœ‰åå·®ï¼Œ6åˆ™ç¨æœ‰ï¼Œ12æ‰ç®—å¤§åå·®]ã€‚
                </div>
                
                <div class="value-grid" id="calibrationArea" style="display: none;">
                    
                    <div class="value-box">
                        <div class="value-title" id="labelLeft">å·¦å€¼Â·å¾®å¿« (æ•°å°)</div>
                        <div class="cm-value" id="leftCm">-- cm</div>
                        <button class="btn-action" id="selectLeftBtn">æ­¤å¿«é€Ÿå¥½</button>
                        <div class="sens-list" id="leftSensList">
                            <span style="color: var(--text-muted);">DPI <span class="current-dpi-display">400</span> ä¸‹:</span>
                            <div id="vCSGO_left">CS2/Apex: <span>--</span></div>
                            <div id="vValo_left">Valorant: <span>--</span></div>
                            <div id="vOW_left">Overwatch: <span>--</span></div>
                        </div>
                        <div id="derivationBox_left" class="derivation-box" style="display:none;">
                            <div class="derivation-title">æ¨å¯¼å…¬å¼:</div>
                            <span id="formulaText_left" class="formula"></span>
                            <div style="margin-top: 5px;">è®¡ç®—æ­¥éª¤:</div>
                            <div id="calcSteps_left" style="font-size: 0.8rem; line-height: 1.4; color: var(--text-muted);"></div>
                        </div>
                    </div>
                    
                    <div class="current-base-column">
                        <div class="current-base-box">
                            <div class="value-title">å½“å‰åŸºå‡†å€¼</div>
                            <div class="cm-value" id="currentBaseDisplay">-- cm</div>
                            <div class="value-info">å½“å‰ DPI: <strong class="current-dpi-display">400</strong></div>
                            <div class="sens-list" id="baseSensList">
                                <span style="color: var(--text-muted);">DPI <span class="current-dpi-display">400</span> ä¸‹:</span>
                                <div id="vCSGO_base">CS2/Apex: <span>--</span></div>
                                <div id="vValo_base">Valorant: <span>--</span></div>
                                <div id="vOW_base">Overwatch: <span>--</span></div>
                            </div>
                        </div>
                        <div id="finalResult" style="display:none;">
                            æœ€ç»ˆç»“æœ
                            <strong id="finalCmValue">--</strong>
                        </div>
                    </div>
                    
                    <div class="value-box">
                        <div class="value-title" id="labelRight">å³å€¼Â·å¾®æ…¢ (æ•°å¤§)</div>
                        <div class="cm-value" id="rightCm">-- cm</div>
                        <button class="btn-action" id="selectRightBtn">æ­¤æ…¢é€Ÿå¥½</button>
                        <div class="sens-list" id="rightSensList">
                            <span style="color: var(--text-muted);">DPI <span class="current-dpi-display">400</span> ä¸‹:</span>
                            <div id="vCSGO_right">CS2/Apex: <span>--</span></div>
                            <div id="vValo_right">Valorant: <span>--</span></div>
                            <div id="vOW_right">Overwatch: <span>--</span></div>
                        </div>
                        <div id="derivationBox_right" class="derivation-box" style="display:none;">
                            <div class="derivation-title">æ¨å¯¼å…¬å¼:</div>
                            <span id="formulaText_right" class="formula"></span>
                            <div style="margin-top: 5px;">è®¡ç®—æ­¥éª¤:</div>
                            <div id="calcSteps_right" style="font-size: 0.8rem; line-height: 1.4; color: var(--text-muted);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="phase3FormulaBar" class="formula-bar" style="display: none;">
                <div class="formula-title" id="formulaTitle">å½“å‰åº”ç”¨å…¬å¼ (ä¸‰é˜¶æ ¡å‡†æ³•æ ¸å¿ƒ)</div>
                <div id="formulaDisplay" class="formula-content"></div>
            </div>
        </main>
        
        <aside class="history-panel pro-card">
            <div class="widget-header">é€‰æ‹©å†å²</div>
            <div id="historyList">
                <div style="font-size: 0.85rem; color: var(--text-muted); text-align: center; padding: 10px;">æš‚æ— è®°å½•</div>
            </div>
        </aside>

    </div> <div class="widget-card float-fixed-left">
        <div class="widget-header">ğŸ® æ¸¸æˆçµæ•è½¬cm360(æ ¡å‡†å‰ç”¨)</div>
        <div style="display:flex; gap:8px; margin-bottom:8px;">
            <div style="flex:1;">
                <label style="font-size:0.75rem; color:var(--text-muted);">DPI</label>
                <input type="number" id="dpiInput" value="400" step="100">
            </div>
            <div style="flex:1;">
                <label style="font-size:0.75rem; color:var(--text-muted);">æ¸¸æˆæ•(ä¸æ˜¯edpi)</label>
                <input type="number" id="sensInput" value="2" step="0.01">
            </div>
        </div>
        <div style="margin-bottom:10px;">
            <label style="font-size:0.75rem; color:var(--text-muted);">æ¸¸æˆç±»å‹</label>
            <div class="custom-select-wrapper">
                <select id="gameType">
                    <option value="csgo">CS2 / Apex</option>
                    <option value="valo">Valorant</option>
                    <option value="ow">Overwatch</option>
                </select>
            </div>
        </div>
        <button class="btn-primary" id="convertBtn" style="width:100%; padding: 8px;">è½¬æ¢</button>
        <div id="convertResult" style="margin-top:10px; text-align:center; color:var(--accent); font-weight:bold; font-size:1.1rem; min-height:1.6rem;"></div>
    </div>

    <div class="widget-card float-fixed-left-top" id="widget-modify">
        <div class="widget-header">âœï¸ ä¿®æ”¹åŸºå‡†å€¼</div>
        <div style="display: flex; gap: 5px;">
            <input type="number" id="manualBaseInput" placeholder="è¾“å…¥æ–°æ•°å€¼">
            <button class="btn-primary" id="manualUpdateBtn" style="width: auto; padding: 6px 12px;">æ›´æ–°</button>
        </div>
    </div>
    
    <div class="widget-card float-fixed-right-top" id="widget-quick-x">
        <div class="widget-header">ğŸ“…  ææ•å››åˆ†æ³•(å‚è€ƒ)</div>
        <div style="margin-bottom:5px;">
            <input type="number" id="jk" placeholder="æœ€å¿«å¯æ§ çµæ•åº¦(æ•°å°)" style="font-size:0.85rem; padding:6px;">
        </div>
        <div style="margin-bottom:5px;">
            <input type="number" id="jm" placeholder="æœ€æ…¢å¯æ§ çµæ•åº¦(æ•°å¤§)" style="font-size:0.85rem; padding:6px;">
        </div>
        <div style="display:flex; gap:5px;">
            <button class="btn-primary" id="quickXSpeedBtn" style="flex:1; padding:6px; font-size:0.8rem;">æ¸¸æˆå…¬å¼</button>
            <button class="btn-primary" id="quickXAccuracyBtn" style="flex:1; padding:6px; font-size:0.8rem;">ç„å‡†å…¬å¼</button>
        </div>
        <div id="quickResult" style="text-align:center; margin-top:5px; color:var(--accent); font-size:0.9rem;"></div>
    </div>

    <div class="float-fixed-right" style="text-align: right;">
        <div class="author-info widget-card" style="box-shadow: none; margin-bottom: 0;"> 
            <a href="https://space.bilibili.com/10778584" target="_blank" class="author-link">é¡¾é—®ï¼šå¢¨æ¾œåŸ</a>
            <span class="separator">/</span>
            <a href="https://space.bilibili.com/481183680" target="_blank" class="author-link">æè®®ï¼šç»´C</a>
            <span class="separator">/</span>
            <a href="https://space.bilibili.com/1124699971" target="_blank" class="author-link">åŠ©åŠ›ï¼šè½¯æ²™</a>
            <span class="separator">/</span>
            <a href="https://space.bilibili.com/1534330" target="_blank" class="author-link">ä½œè€…ï¼šè¥¿å²›æµ·</a>
            <a href="/juan.png" target="_blank" class="donate-btn" title="ç‚¹å‡»èµåŠ©ä½œè€…">æ</a>
        </div>
    </div>

    <div class="audio-player-container">
        <audio id="coreAudioPlayer" src="http://xidaohai.github.io/1.mp3" preload="auto"></audio>
        
        <div class="audio-player-panel">
            <span class="track-info">ğŸ¶ æ­Œæ›² - Remind me (feat. Nights2050)</span>
            <button class="play-pause-btn" id="playPauseBtn">
                <span class="icon play" id="playPauseIcon"></span>
            </button>
        </div>
    </div>
    <script>
    // =================================================================
    // ã€æ ¸å¿ƒå‚æ•°ä¸å…¬å¼é…ç½®åŒºã€‘
    // =================================================================

    window.PHASE_FORMULAS = {
        // é˜¶æ®µ I
        P1_LEFT_DENOM_OFFSET: 135, 
        P1_RIGHT_DENOM_OFFSET: 78.75, 

        // é˜¶æ®µ II (å‹å¿«æ•)
        P2_LEFT_DENOM_OFFSET: 99, 
        P2_RIGHT_DENOM_OFFSET: 61.875, 

        // é˜¶æ®µ III (ç»†å¸¸æ•)
        P3_LEFT_DENOM_OFFSET: 45, 
        P3_RIGHT_DENOM_OFFSET: 45, 
        P3_SELECTION_THRESHOLD: 3, 
    };

    window.CONSTANT_GAME_FACTOR = {
        csgo: 0.022, 
        valo: 0.07, 
        ow: 0.0066 
    };

    window.CONSTANT_CM_TO_SENS = {
        // CM/360Â° è½¬ æ¸¸æˆçµæ•åº¦çš„åˆ†å­å¸¸æ•° (Const = 360 * 2.54 / Factor)
        VALO_CM_FACTOR: 13062.857, // 360 * 2.54 / 0.07
        OW_CM_FACTOR: 138545.455,  // 360 * 2.54 / 0.0066
        CSGO_CM_FACTOR: 41563.636 // 360 * 2.54 / 0.022
    };

    window.QUICK_X_DIVISOR = 4; // ææ•å†…æ¨åˆ†æ¯
    
    // =================================================================
    // æ ¸å¿ƒå˜é‡ä¸å‡½æ•°åŒº
    // =================================================================
    let currentPhase = 1;
    let currentBase = 0;
    let dpi = 400;
    let phase3Count = 0;
    const FULL_CIRCLE_DEGREE = 360; 
    const INCH_TO_CM_FACTOR = 2.54; 

    // --- åˆå§‹åŒ–åŠäº‹ä»¶ç»‘å®š ---
    window.onload = function() {
        // å¼¹çª—å’ŒDPIæ˜¾ç¤ºåˆå§‹åŒ–
        setTimeout(() => {
            document.getElementById('welcomeModal').style.opacity = '1';
            document.getElementById('welcomeModal').style.pointerEvents = 'auto';
        }, 100);
        document.querySelectorAll('.current-dpi-display').forEach(el => el.textContent = dpi);

        // æ ¸å¿ƒäº‹ä»¶ç»‘å®š
        document.getElementById('closeModalBtn').addEventListener('click', closeModal);

        // å¼€å§‹æ ¡å‡†
        const startBtn = document.getElementById('startCalibrationBtn');
        if (startBtn) {
            startBtn.addEventListener('click', function() {
                startPhase(1);
            });
        }
        
        // é˜¶æ®µåˆ‡æ¢æŒ‰é’®
        document.getElementById('switchPhase1Btn').addEventListener('click', () => switchPhase(1));
        document.getElementById('switchPhase2Btn').addEventListener('click', () => switchPhase(2));
        document.getElementById('switchPhase3Btn').addEventListener('click', () => switchPhase(3));

        // é€‰æ‹©å€¼æŒ‰é’®
        const selectLeftBtn = document.getElementById('selectLeftBtn');
        const selectRightBtn = document.getElementById('selectRightBtn');
        if (selectLeftBtn) selectLeftBtn.addEventListener('click', () => selectValue('left'));
        if (selectRightBtn) selectRightBtn.addEventListener('click', () => selectValue('right'));

        // çµæ•åº¦è½¬æ¢å·¥å…·
        document.getElementById('dpiInput').addEventListener('input', function(e) {
            dpi = parseFloat(this.value) || 400;
            document.querySelectorAll('.current-dpi-display').forEach(el => el.textContent = dpi);
            if(currentBase > 0) refreshValues();
        });
        document.getElementById('convertBtn').addEventListener('click', calculateCm360);

        // ä¿®æ”¹åŸºå‡†å€¼å·¥å…·
        document.getElementById('manualUpdateBtn').addEventListener('click', manualUpdateBase);

        // ææ•å†…æ¨å·¥å…·
        document.getElementById('quickXSpeedBtn').addEventListener('click', () => calcQuickX(1));
        document.getElementById('quickXAccuracyBtn').addEventListener('click', () => calcQuickX(2));
        
        // **æ–°å¢ï¼šéŸ³é¢‘æ’­æ”¾å™¨äº‹ä»¶ç»‘å®š**
        const audio = document.getElementById('coreAudioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playPauseIcon = document.getElementById('playPauseIcon');

        playPauseBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playPauseIcon.classList.remove('play');
                playPauseIcon.classList.add('pause');
            } else {
                audio.pause();
                playPauseIcon.classList.remove('pause');
                playPauseIcon.classList.add('play');
            }
        });
        
        // ç¡®ä¿é¦–æ¬¡åŠ è½½å›¾æ ‡æ˜¯æ­£ç¡®çš„ï¼ˆé»˜è®¤æš‚åœï¼‰
        if (audio.paused) {
            playPauseIcon.classList.add('play');
        }
    };

    // -----------------------------------------------------------------
    // --- ç•Œé¢æ§åˆ¶å‡½æ•° ---

    function closeModal() {
        const modal = document.getElementById('welcomeModal');
        modal.style.opacity = '0';
        modal.style.pointerEvents = 'none';
    }

    // -----------------------------------------------------------------
    // --- æ ¡å‡†æ ¸å¿ƒå‡½æ•° ---

    function startPhase(phase) {
        const val = parseFloat(document.getElementById('inputCm').value);
        if (!val || val <= 0) {
            alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼");
            return;
        }
        currentBase = val;
        switchPhase(phase);
        document.getElementById('calibrationArea').style.display = 'grid';
        
        // ç¬¬ä¸€æ¬¡å¼€å§‹æ ¡å‡†ï¼Œé‡ç½®æ‰€æœ‰å†å²
        document.getElementById('historyList').innerHTML = '<div style="font-size: 0.85rem; color: var(--text-muted); text-align: center; padding: 10px;">æš‚æ— è®°å½•</div>';
        addHistory(`å¼€å§‹æ ¡å‡†, åŸºå‡†å€¼: ${currentBase.toFixed(2)} cm`, phase);
    }

    function switchPhase(phase) {
        currentPhase = phase;
        phase3Count = 0; // åˆ‡æ¢é˜¶æ®µæ—¶é‡ç½®é˜¶æ®µ3è®¡æ•°å™¨

        // æ›´æ–° Tab æ ·å¼
        document.querySelectorAll('.phase-tabs button.phase-tab').forEach(tab => tab.classList.remove('active'));
        if (phase === 1) document.getElementById('switchPhase1Btn').classList.add('active');
        if (phase === 2) document.getElementById('switchPhase2Btn').classList.add('active');
        if (phase === 3) document.getElementById('switchPhase3Btn').classList.add('active');

        // æ›´æ–°æç¤ºæ–‡å­—æ˜¾éš
        document.getElementById('phase1Note').style.display = phase === 1 ? 'block' : 'none';
        document.getElementById('phase2Note').style.display = phase === 2 ? 'block' : 'none';
        document.getElementById('phase3Note').style.display = phase === 3 ? 'block' : 'none';

        // æ›´æ–°æ ‡ç­¾æ–‡å­—
        if (phase === 1) {
            document.getElementById('labelLeft').textContent = "å·¦å€¼Â·å¿«æ• (æ•°å°)";
            document.getElementById('labelRight').textContent = "å³å€¼Â·æ…¢æ• (æ•°å¤§)";
        } else if (phase === 2) {
            document.getElementById('labelLeft').textContent = "å¿«æ• (æé€Ÿ)";
            document.getElementById('labelRight').textContent = "æ…¢æ• (å›ç¨³)";
        } else {
            document.getElementById('labelLeft').textContent = "å·¦å€¼Â·å¾®å¿« (æ•°å°)";
            document.getElementById('labelRight').textContent = "å³å€¼Â·å¾®æ…¢ (æ•°å¤§)";
        }

        // å¦‚æœå·²æœ‰åŸºå‡†å€¼ï¼Œåˆ·æ–°è®¡ç®—
        if (currentBase > 0) {
            document.getElementById('calibrationArea').style.display = 'grid';
            refreshValues();
            addHistory(`åˆ‡æ¢è‡³é˜¶æ®µ ${phase}`, phase);
        }
    }

    function refreshValues() {
        if (currentBase <= 0) return;

        let left, right;
        const base = currentBase;
        const fullCircle = FULL_CIRCLE_DEGREE;

        // ç¡®ä¿ PHASE_FORMULAS å­˜åœ¨
        if (typeof window.PHASE_FORMULAS === 'undefined') {
            console.error("PHASE_FORMULAS æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥æ ¸å¿ƒå¸¸é‡ã€‚");
            return;
        }
        const P = window.PHASE_FORMULAS;

        // æ ¹æ®é˜¶æ®µåº”ç”¨å…¬å¼
        if (currentPhase === 1) {
            // P1: å·¦å€¼ = (åŸºå‡† * 360) / (360 + 135) ; å³å€¼ = (åŸºå‡† * 360) / (360 - 78.75)
            left = (base * fullCircle) / (fullCircle + P.P1_LEFT_DENOM_OFFSET);
            right = (base * fullCircle) / (fullCircle - P.P1_RIGHT_DENOM_OFFSET);
        } else if (currentPhase === 2) {
            // P2: å·¦å€¼ = (åŸºå‡† * 360) / (360 + 99) ; å³å€¼ = (åŸºå‡† * 360) / (360 - 55)
            left = (base * fullCircle) / (fullCircle + P.P2_LEFT_DENOM_OFFSET);
            right = (base * fullCircle) / (fullCircle - P.P2_RIGHT_DENOM_OFFSET);
        } else {
            // P3 (Macro - ç”¨æˆ·è¦æ±‚ 45åº¦æ¯”ä¾‹): å·¦å€¼ = (åŸºå‡† * 360) / (360 + 45) ; å³å€¼ = (åŸºå‡† * 360) / (360 - 45)
            left = (base * fullCircle) / (fullCircle + P.P3_LEFT_DENOM_OFFSET);
            right = (base * fullCircle) / (fullCircle - P.P3_RIGHT_DENOM_OFFSET);
        }

        // æ›´æ–°UI
        document.getElementById('currentBaseDisplay').textContent = base.toFixed(2) + ' cm';
        updateGameSens('base', base);

        document.getElementById('leftCm').textContent = left.toFixed(2) + ' cm';
        updateGameSens('left', left);

        document.getElementById('rightCm').textContent = right.toFixed(2) + ' cm';
        updateGameSens('right', right);

        // é˜¶æ®µ3æ˜¾ç¤ºæœ€ç»ˆç»“æœ
        if (currentPhase === 3 && phase3Count >= P.P3_SELECTION_THRESHOLD) {
            document.getElementById('finalResult').style.display = 'block';
            document.getElementById('finalCmValue').textContent = base.toFixed(2);
        } else {
            document.getElementById('finalResult').style.display = 'none';
        }
        
        // ã€ä¿®æ”¹ç‚¹ 1 & 3: æ›´æ–°å…¬å¼æ˜¾ç¤ºæ  (é€‚ç”¨äºæ‰€æœ‰é˜¶æ®µ)ã€‘
        const formulaBar = document.getElementById('phase3FormulaBar');
        const formulaDisplay = document.getElementById('formulaDisplay');
        const formulaTitle = document.getElementById('formulaTitle');
        
        formulaBar.style.display = 'flex'; // æ˜¾ç¤ºæ¨ªæ¡

        let leftRatio, rightRatio;
        let titleText;

        if (currentPhase === 1) {
            const leftDenominator = fullCircle + P.P1_LEFT_DENOM_OFFSET;
            const rightDenominator = fullCircle - P.P1_RIGHT_DENOM_OFFSET;
            leftRatio = (fullCircle / leftDenominator).toFixed(4); // 0.7273
            rightRatio = (fullCircle / rightDenominator).toFixed(4); // 1.2800
            titleText = `I åˆé˜¶Â·æ¡†å¤§æ• (å®è§‚å€ç‡)`;
        } else if (currentPhase === 2) {
            const leftDenominator = fullCircle + P.P2_LEFT_DENOM_OFFSET;
            const rightDenominator = fullCircle - P.P2_RIGHT_DENOM_OFFSET;
            leftRatio = (fullCircle / leftDenominator).toFixed(4); // 0.7843
            rightRatio = (fullCircle / rightDenominator).toFixed(4); // 1.1803
            titleText = `II äºŒé˜¶Â·å‹å¿«æ• (å®è§‚å€ç‡)`;
        } else { // currentPhase === 3
            const leftDenominator = fullCircle + P.P3_LEFT_DENOM_OFFSET;
            const rightDenominator = fullCircle - P.P3_RIGHT_DENOM_OFFSET;
            leftRatio = (fullCircle / leftDenominator).toFixed(4); // 0.8889
            rightRatio = (fullCircle / rightDenominator).toFixed(4); // 1.1429
            titleText = `III ä¸‰é˜¶Â·æ‹”æ…¢æ• (å®è§‚å€ç‡)`;
        }

        formulaTitle.textContent = titleText;
        // ã€ä¿®æ”¹ç‚¹ 2: å…¬å¼æ–‡æœ¬æ˜¾ç¤ºï¼Œå¹¶ä½¿ç”¨æ›´æ·¡çš„é¢œè‰²ã€‘
        formulaDisplay.innerHTML = `å·¦å€¼ (å¿«): æ—§å€¼ Ã— ${leftRatio} &nbsp;&nbsp;|&nbsp;&nbsp; å³å€¼ (æ…¢): æ—§å€¼ Ã— ${rightRatio}`;

        // éšè—å…¬å¼æ¨å¯¼ (æ¯æ¬¡åˆ·æ–°éƒ½éšè—)
        document.getElementById('derivationBox_left').style.display = 'none';
        document.getElementById('derivationBox_right').style.display = 'none';
    }

    function selectValue(side) {
        // ç¬¬ä¸‰é˜¶æ®µé€‰æ‹©è®¡æ•°
        phase3Count += (currentPhase === 3 ? 1 : 0);

        // é‡æ–°è®¡ç®—å½“å‰æ­¥éª¤çš„å·¦å³å€¼ï¼ˆç¡®ä¿æ¨å¯¼è¿‡ç¨‹å…¬å¼æ–‡æœ¬å‡†ç¡®ï¼‰
        let left, right;
        let formulaText = "";
        let calcHtml = "";
        const base = currentBase;
        const fullCircle = FULL_CIRCLE_DEGREE;
        
        if (typeof window.PHASE_FORMULAS === 'undefined') {
            console.error("PHASE_FORMULAS æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥æ ¸å¿ƒå¸¸é‡ã€‚");
            return;
        }
        const P = window.PHASE_FORMULAS;

        if (currentPhase === 1) {
            left = (base * fullCircle) / (fullCircle + P.P1_LEFT_DENOM_OFFSET);
            right = (base * fullCircle) / (fullCircle - P.P1_RIGHT_DENOM_OFFSET);
            const oldAngle = (fullCircle / base).toFixed(2);
            
            if (side === 'left') {
                formulaText = `(æ—§å€¼ Ã— 360Â°) Ã· (360Â° + ${P.P1_LEFT_DENOM_OFFSET}Â°)`;
                calcHtml = `
                    åŸºå‡†è§’åº¦: ${ oldAngle }Â° <br> 
                    (${base.toFixed(2)} Ã— 360) / (360 + ${P.P1_LEFT_DENOM_OFFSET}) = ${left.toFixed(2)} cm
                `;
            } else {
                formulaText = `(æ—§å€¼ Ã— 360Â°) Ã· (360Â° - ${P.P1_RIGHT_DENOM_OFFSET}Â°)`;
                calcHtml = `
                    åŸºå‡†è§’åº¦: ${ oldAngle }Â° <br> 
                    (${base.toFixed(2)} Ã— 360) / (360 - ${P.P1_RIGHT_DENOM_OFFSET}) = ${right.toFixed(2)} cm
                `;
            }
        } else if (currentPhase === 2) {
            left = (base * fullCircle) / (fullCircle + P.P2_LEFT_DENOM_OFFSET);
            right = (base * fullCircle) / (fullCircle - P.P2_RIGHT_DENOM_OFFSET);
            const oldAngle = (fullCircle / base).toFixed(2);

            if (side === 'left') {
                formulaText = `(æ—§å€¼ Ã— 360Â°) Ã· (360Â° + ${P.P2_LEFT_DENOM_OFFSET}Â°)`;
                calcHtml = `
                    åŸºå‡†è§’åº¦: ${ oldAngle }Â° <br> 
                    (${base.toFixed(2)} Ã— 360) / (360 + ${P.P2_LEFT_DENOM_OFFSET}) = ${left.toFixed(2)} cm
                `;
            } else {
                formulaText = `(æ—§å€¼ Ã— 360Â°) Ã· (360Â° - ${P.P2_RIGHT_DENOM_OFFSET}Â°)`;
                calcHtml = `
                    åŸºå‡†è§’åº¦: ${ oldAngle }Â° <br> 
                    (${base.toFixed(2)} Ã— 360) / (360 - ${P.P2_RIGHT_DENOM_OFFSET}) = ${right.toFixed(2)} cm
                `;
            }
        } else {
            // P3 (Macro - ç”¨æˆ·è¦æ±‚ 45åº¦æ¯”ä¾‹)
            left = (base * fullCircle) / (fullCircle + P.P3_LEFT_DENOM_OFFSET);
            right = (base * fullCircle) / (fullCircle - P.P3_RIGHT_DENOM_OFFSET);
            
            const leftDenominator = fullCircle + P.P3_LEFT_DENOM_OFFSET;
            const rightDenominator = fullCircle - P.P3_RIGHT_DENOM_OFFSET;
            const leftRatio = (fullCircle / leftDenominator).toFixed(4);
            const rightRatio = (fullCircle / rightDenominator).toFixed(4);
            const oldAngle = (fullCircle / base).toFixed(2);

            if (side === 'left') {
                formulaText = `(æ—§å€¼ Ã— 360Â°) Ã· (360Â° + 45Â°)`;
                calcHtml = `
                    **å®è§‚æ¯”ä¾‹è°ƒå¿« (${leftRatio}å€)**<br>
                    åŸºå‡†è§’åº¦: ${ oldAngle }Â° <br> 
                    (${base.toFixed(2)} Ã— 360) / (${leftDenominator}) = ${left.toFixed(2)} cm
                `;
            } else {
                formulaText = `(æ—§å€¼ Ã— 360Â°) Ã· (360Â° - 45Â°)`;
                calcHtml = `
                    **å®è§‚æ¯”ä¾‹è°ƒæ…¢ (${rightRatio}å€)**<br>
                    åŸºå‡†è§’åº¦: ${ oldAngle }Â° <br> 
                    (${base.toFixed(2)} Ã— 360) / (${rightDenominator}) = ${right.toFixed(2)} cm
                `;
            }
        }

        const oldBase = currentBase;
        const newVal = side === 'left' ? left : right;
        currentBase = newVal; // æ›´æ–°åŸºå‡†å€¼

        // æ›´æ–°æ¨å¯¼å…¬å¼UI
        const box = document.getElementById(side === 'left' ? 'derivationBox_left' : 'derivationBox_right');
        const formulaEl = document.getElementById(side === 'left' ? 'formulaText_left' : 'formulaText_right');
        const calcEl = document.getElementById(side === 'left' ? 'calcSteps_left' : 'calcSteps_right');

        formulaEl.textContent = formulaText;
        calcEl.innerHTML = calcHtml;
        box.style.display = 'block';

        refreshValues();

        // å†å²è®°å½•
        addHistory(`P${currentPhase} é€‰æ‹©${side === 'left' ? 'å¿«æ•' : 'æ…¢æ•'}, ${oldBase.toFixed(2)} -> ${newVal.toFixed(2)}`, currentPhase);
    }

    function manualUpdateBase() {
        const val = parseFloat(document.getElementById('manualBaseInput').value);
        if (!val || val <= 0) {
            alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼");
            return;
        }

        const oldBase = currentBase;
        currentBase = val;
        
        // æ‰‹åŠ¨ä¿®æ”¹åŸºå‡†å€¼æ—¶ï¼Œé‡ç½®ç¬¬ä¸‰é˜¶æ®µè®¡æ•°å™¨
        if (currentPhase === 3) phase3Count = 0; 
        
        refreshValues();
        addHistory(`æ‰‹åŠ¨ä¿®æ”¹åŸºå‡†ä¸º: ${oldBase.toFixed(2)} -> ${val.toFixed(2)}`, currentPhase);
        document.getElementById('manualBaseInput').value = '';
    }

    // -----------------------------------------------------------------
    // --- è¾…åŠ©å·¥å…·å‡½æ•° ---

    /**
     * @description å†å²è®°å½•é¢æ¿æ·»åŠ è®°å½•
     */
    function addHistory(text, phase) {
        const list = document.getElementById('historyList');
        if (!list) return;

        if(list.children[0] && list.children[0].innerText === "æš‚æ— è®°å½•") {
             list.innerHTML = '';
        }

        const item = document.createElement('div');
        item.className = `history-item phase-${phase}`;
        const time = new Date().toLocaleTimeString();
        item.innerHTML = `<div>${text}</div><div style="font-size:0.7rem; color:var(--text-muted); text-align:right;">${time}</div>`;
        list.prepend(item); 
    }
    
    /**
     * @description å°† cm/360Â° è½¬æ¢ä¸ºæŒ‡å®šæ¸¸æˆçš„çµæ•åº¦ã€‚
     * @param {string} prefix - UIå…ƒç´ å‰ç¼€ ('base', 'left', 'right')
     * @param {number} cm - cm/360Â°å€¼
     */
    function updateGameSens(prefix, cm) {
        if (cm <= 0) return;
        
        if (typeof window.CONSTANT_CM_TO_SENS === 'undefined') {
            console.error("CONSTANT_CM_TO_SENS æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥æ ¸å¿ƒå¸¸é‡ã€‚");
            return;
        }

        const C = window.CONSTANT_CM_TO_SENS;
        const divisor = cm * dpi; 

        // Valorant: Sens = 13062.857 / (cm * dpi)
        const vValo = (C.VALO_CM_FACTOR / divisor).toFixed(3);
        // OW/Apex: Sens = 138545.455 / (cm * dpi)
        const vOW = (C.OW_CM_FACTOR / divisor).toFixed(3);
        // CS2: Sens = 41563.636 / (cm * dpi)
        const vCSGO = (C.CSGO_CM_FACTOR / divisor).toFixed(3);

        // æ›´æ–° UI
        document.getElementById(`vValo_${prefix}`).querySelector('span').textContent = vValo;
        document.getElementById(`vOW_${prefix}`).querySelector('span').textContent = vOW;
        document.getElementById(`vCSGO_${prefix}`).querySelector('span').textContent = vCSGO;
    }
    
    // çµæ•åº¦è½¬æ¢å·¥å…·
    function calculateCm360() {
        const d = parseFloat(document.getElementById('dpiInput').value); 
        const s = parseFloat(document.getElementById('sensInput').value);
        const type = document.getElementById('gameType').value;
        
        if (!d || !s) {
            document.getElementById('convertResult').textContent = `è¯·è¾“å…¥ DPI å’Œ çµæ•åº¦`;
            return;
        }
        
        if (typeof window.CONSTANT_GAME_FACTOR === 'undefined') {
            document.getElementById('convertResult').textContent = `é”™è¯¯: æ¸¸æˆå› å­å¸¸é‡ç¼ºå¤±`;
            return;
        }
        
        let factor = window.CONSTANT_GAME_FACTOR.csgo; 
        if (type === 'valo') factor = window.CONSTANT_GAME_FACTOR.valo;
        if (type === 'ow') factor = window.CONSTANT_GAME_FACTOR.ow;

        // cm/360 = (360 * 2.54) / (sens * DPI * factor)
        const cm = (FULL_CIRCLE_DEGREE * INCH_TO_CM_FACTOR) / (s * d * factor);
        document.getElementById('convertResult').textContent = `${cm.toFixed(2)} cm/360Â°`;
    }

    // ææ•å†…æ¨å·¥å…·
    function calcQuickX(mode) {
        const k = parseFloat(document.getElementById('jk').value);
        const m = parseFloat(document.getElementById('jm').value);
        // const fullCircle = FULL_CIRCLE_DEGREE;
        
        if (!k || !m || k <= 0 || m <= 0) {
            document.getElementById('quickResult').textContent = `è¯·è¾“å…¥æœ‰æ•ˆæ•°å€¼`;
            return;
        }
        
        if (k >= m) {
            document.getElementById('quickResult').textContent = `è¯·ç¡®ä¿ æœ€å¿«å¯æ§(k) < æœ€æ…¢å¯æ§(m)`;
            return;
        }
        
        // if (typeof window.QUICK_X_DIVISOR === 'undefined') {
        //     document.getElementById('quickResult').textContent = `é”™è¯¯: åˆ†æ¯å¸¸é‡ç¼ºå¤±`;
        //     return;
        // }
        // const DIVISOR = window.QUICK_X_DIVISOR;

        // æ­¥éª¤1: ä½¿ç”¨æ–°çš„åŠ æƒå¹³å‡å…¬å¼ç›´æ¥è®¡ç®— cm å€¼
        let res;
        if (mode === 1) {
            // ç„å‡†å…¬å¼ï¼ˆç²¾åº¦ï¼‰
            // k: æœ€å¿«å¯æ§ çµæ•åº¦(æ•°å°)
            // m: æœ€æ…¢å¯æ§ çµæ•åº¦(æ•°å¤§)
            res = (3 * k + m) / 4;
        } else {
            // æ¸¸æˆå…¬å¼ï¼ˆé€Ÿåº¦ï¼‰
            res = (3 * m + k) / 4;
        }
        
        // **åŸä»£ç é€»è¾‘ï¼ˆå·²æ³¨é‡Šï¼ŒæŒ‰ç…§è¦æ±‚ä¸åˆ å‡ï¼‰**
        // // æ­¥éª¤1: è½¬æ¢æˆè§’åº¦å€¼ (è§’åº¦å€¼ = 360 / cm/360Â°)
        // const angleK = fullCircle / k;
        // const angleM = fullCircle / m;

        // // æ­¥éª¤2: è®¡ç®—è§’åº¦å·®å€¼ï¼ˆdeltaï¼‰
        // const delta = (angleK - angleM) / DIVISOR;

        // // æ­¥éª¤3: è®¡ç®—ç›®æ ‡è§’åº¦å€¼
        // let resAngle;
        // if (mode === 1) {
        //     // é€Ÿåº¦å…¬å¼ï¼š1/4å¤„ (angleM + 1*delta)
        //     resAngle = angleM + delta;
        // } else {
        //     // ç²¾åº¦å…¬å¼ï¼š3/4å¤„ (angleM + 3*delta)
        //     resAngle = angleM + (3 * delta);
        // }

        // // æ­¥éª¤4: è½¬æ¢å› cm/360Â°
        // const res = fullCircle / resAngle;

        document.getElementById('quickResult').textContent = `å‚è€ƒç»“æœ: ${res.toFixed(2)} cm`;
    }
    
</script>

</body>


</html>









