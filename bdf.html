<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>西岛海 · 完美灵敏度公式 · 三阶集成版</title>
    <style>
        :root {
            --bg-primary: #121212;
            --bg-secondary: rgba(30, 30, 30, 0.9);
            --bg-tertiary: rgba(45, 45, 45, 0.8);
            --card-bg: rgba(34, 34, 34, 0.8);
            --text-primary: #E0E0E0;
            --text-secondary: #A0A0A0;
            --accent-blue: #64B5F6;
            --accent-green: #4CAF50;
            --accent-red: #FF5252;
            --accent-gold: #FFD700;
            --border-color: rgba(60, 60, 60, 0.8);
            --shadow-color-dark: rgba(0, 0, 0, 0.6);
            /* 新增变量：右侧悬浮窗宽度 */
            --floating-note-width: 250px; 
            /* 新增变量：主内容区最大宽度，为适应悬浮窗而减小 */
            --main-content-max-width: 1050px; 
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            /* 调整最大宽度以保证不遮挡右侧悬浮窗，并留出间隙 */
            max-width: var(--main-content-max-width); 
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header { text-align: center; padding: 20px 0; }
        .header h1 { font-size: 2.2rem; margin-bottom: 5px; font-weight: 300; }
        .header p { color: var(--text-secondary); }

        /* 输入区域样式 */
        .card {
            background-color: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px var(--shadow-color-dark);
        }

        .input-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .input-group { flex: 1; min-width: 250px; display: flex; flex-direction: column; gap: 8px; }
        .input-group label { color: var(--text-secondary); font-size: 0.9rem; }
        .input-group input {
            padding: 12px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
        }
        .input-group input:focus { outline: none; border-color: var(--accent-blue); }

        .btn-primary {
            background-color: var(--accent-blue);
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 20px;
            width: 100%;
        }
        .btn-primary:hover { background-color: #5a9cdb; transform: translateY(-2px); }

        /* =========================================
           三段式结果行样式 (核心修改)
           ========================================= */
        .complex-result-row {
            display: flex;
            align-items: stretch;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* 左侧：倍率调整 */
        .panel-left {
            flex: 0 0 120px;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border-right: 3px solid var(--accent-gold);
        }
        .panel-title { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 5px; }
        .multiplier-input {
            width: 100%;
            padding: 5px;
            text-align: center;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            color: var(--accent-gold);
            border-radius: 5px;
            font-weight: bold;
        }

        /* 中间：核心结果展示 */
        .panel-center {
            flex: 1;
            min-width: 280px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        .result-label { color: var(--accent-blue); font-weight: bold; font-size: 1rem; margin-bottom: 5px; }
        .result-value-main { font-size: 2rem; font-weight: 300; color: var(--text-primary); text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .result-sub { font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px; }

        /* 右侧：三阶校准面板 */
        .panel-right {
            flex: 1; /* 占据剩余空间，或者设置为固定宽 */
            min-width: 320px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-left: 3px solid var(--accent-green);
        }
        
        .calibration-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 8px;
            border-bottom: 1px dashed var(--border-color);
            font-size: 0.9rem;
        }
        
        .current-base-wrapper {
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            margin-bottom: 5px;
        }
        .current-base-val { font-size: 1.4rem; color: var(--accent-green); font-weight: bold; }
        
        .calibration-actions {
            display: flex;
            gap: 10px;
        }
        .cal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .cal-btn span { font-size: 0.75rem; opacity: 0.8; margin-top: 2px; }
        
        .btn-fast { background-color: rgba(100, 181, 246, 0.15); color: var(--accent-blue); border: 1px solid rgba(100, 181, 246, 0.3); }
        .btn-fast:hover { background-color: rgba(100, 181, 246, 0.3); }
        
        .btn-slow { background-color: rgba(255, 82, 82, 0.15); color: var(--accent-light-red); border: 1px solid rgba(255, 82, 82, 0.3); }
        .btn-slow:hover { background-color: rgba(255, 82, 82, 0.3); }

        .btn-reset {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 4px 8px;
            font-size: 0.75rem;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-reset:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }

        /* 变量说明卡片样式 */
        .variable-explanation-card {
            background-color: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px var(--shadow-color-dark);
        }
        .variable-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .variable-table th, .variable-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        .variable-table th {
            font-weight: bold;
            color: var(--accent-blue);
        }
        .variable-table tr:hover {
            background-color: var(--bg-tertiary);
        }

        /* =========================================
           右侧悬浮静态说明框样式
           ========================================= */
        .floating-note-panel {
            position: fixed;
            top: 50%; /* 垂直居中 */
            right: 20px;
            transform: translateY(-50%);
            width: var(--floating-note-width);
            max-height: 80vh;
            background-color: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px var(--shadow-color-dark);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .floating-note-panel h3 {
            font-size: 1.1rem;
            color: var(--accent-gold);
            padding-bottom: 5px;
            border-bottom: 1px dashed var(--border-color);
        }
        .note-content { /* 静态内容容器 */
            flex-grow: 1;
            overflow-y: auto; /* 允许内容过多时滚动 */
            padding: 5px;
            background-color: var(--bg-secondary);
            border: 1px solid rgba(100, 100, 100, 0.5);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.8;
            height: 400px; /* 设定一个合理的固定高度 */
        }
        
        /* ------------------------------------- */
        /* 滚动条美化 (针对 WebKit/Blink 浏览器) */
        /* ------------------------------------- */
        .note-content::-webkit-scrollbar {
            width: 8px; /* 垂直滚动条宽度 */
        }

        .note-content::-webkit-scrollbar-track {
            background: var(--bg-primary); /* 滚动条轨道背景 */
            border-radius: 4px;
        }

        .note-content::-webkit-scrollbar-thumb {
            background-color: var(--accent-gold); /* 滑块颜色 */
            border-radius: 4px;
            border: 2px solid var(--bg-primary); /* 制造间隔 */
        }
        
        .note-content::-webkit-scrollbar-thumb:hover {
            background-color: #ffd200; /* 悬停颜色 */
        }
        
        /* ------------------------------------- */
        /* 响应式调整 (兼容手机/移动端) */
        /* ------------------------------------- */
        @media (max-width: 1350px) { /* 当屏幕变窄时，隐藏笔记面板 */
             .floating-note-panel {
                display: none; /* 彻底隐藏悬浮窗 */
            }
            .container {
                max-width: 1300px; /* 恢复原来的最大宽度 */
            }
        }
        
        @media (max-width: 900px) {
            .complex-result-row { flex-direction: column; }
            .panel-left, .panel-center, .panel-right { width: 100%; border: none; }
            .panel-left { border-bottom: 2px solid var(--accent-gold); flex-direction: row; gap: 15px; justify-content: space-between; }
            .panel-right { border-top: 2px solid var(--accent-green); }
            .input-group { min-width: 100%; }
        }

        /* 浮动链接 */
        .floating-author-link {
            position: fixed; bottom: 20px; right: 20px; z-index: 1000;
        }
        .floating-author-link a {
            background-color: var(--bg-tertiary); backdrop-filter: blur(10px);
            border: 1px solid var(--border-color); color: var(--text-primary);
            text-decoration: none; font-weight: bold; padding: 10px 20px;
            border-radius: 50px; box-shadow: 0 4px 12px var(--shadow-color-dark);
            display: flex; align-items: center; gap: 10px;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
</head>
<body>

<div class="container">
    <div class="header">
        <h1>西岛海 · 灵敏度表达法 · 三阶集成版</h1>
        <p>公式计算 + 倍率调整 + 三阶校准 一站式工具</p>
    </div>

    <div class="variable-explanation-card">
        <h2><i class="fas fa-info-circle"></i> 变量说明</h2>
        <table class="variable-table">
            <thead>
                 <tr>
                    <th>变量</th>
                    <th>定义</th>
                    <th>得值关键</th>
                </tr>
             </thead>
            <tbody>
                <tr>
                    <td>变量X</td>
                    <td>固定手腕以最大幅度摆动，准星恰好经过目标大小的cm/360°灵敏度。</td>
                    <td>①.摆动手时请放松 ②.cm/360°反复调整 ③.使得准星划过目标大小时，不多不少</td>
                 </tr>
                <tr>
                    <td>变量Y</td>
                    <td>固定手腕以最大幅度摆动，准星恰好经过常用甩枪距离的cm/360°灵敏度。</td>
                    <td>①.同上②.同上 ③.使得准星划过常用甩枪距离，不多不少（相当于准星移至目标中心点）</td>
                
                 </tr>
            </tbody>
        </table>
    </div>
    
    <div class="card">
        <h2><i class="fas fa-calculator"></i> 主表达计算 </h2>
        <div class="input-row" style="margin-top: 15px;">
            <div class="input-group">
                <label>变量 X cm/360°（一般在500-5000之间）（常见于1000-4000之间）：</label>
                <input type="number" id="x" value="4000" step="0.1">
            </div>
            <div class="input-group">
                <label>变量 Y cm/360°（一般在20-4000之间）（常见于100-1000之间）：</label>
                <input type="number" id="y" value="200" step="0.1">
            </div>
        </div>
        <button class="btn-primary" onclick="calculateAll()">进行计算</button>
    </div>

    <div id="resultsArea">
        </div>
    
    <div class="card">
        <h3 style="color: var(--text-secondary); font-size: 1rem; margin-bottom: 10px;">公式逻辑说明</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem;">
            1. <strong>左侧倍率</strong>：直接乘在 X、Y 的计算结果上，用于整体调节手感比例。<br>
            2. <strong>中间结果</strong>：基于 X、Y 和倍率计算出的理论 cm/360° 值。<br>
            3. <strong>右侧三阶</strong>：引用我三阶校准法(Phase 3)的逻辑。是 cm/360°±45° 的结果。<br>
        </p>
    </div>
</div>

<div class="floating-note-panel">
    <h3><i class="fas fa-clipboard-list"></i> 来自于作者的话</h3>
    <div class="note-content">
        <p style="color: var(--accent-gold); margin-bottom: 10px;">往往不是不好用，而是没测准</p>
        <p>1. <strong>固定手腕</strong>：意味着需要【死死按在鼠标垫】上。</p>
        <p>2. <strong>放松摆动</strong>：意味着让手部摆动角度最大化，但不必故意摆到手很疼。</p>
        <p>3. <strong>不要动臂</strong>：手臂也要【死死的按着】，务必不要动，哪怕一点。</p>
        <p>4. <strong>倍率调整</strong>：不必动，除非你适应的灵敏度普遍与人不同。</p>
        <p>5. <strong>别看只给了三个值</strong>：由这三个【经典值】可以引发出各种值，比如你选的某个值【除以2、1.75、1.5、1.25】或者【乘以1.25、乃至1.5甚至2】，结果都是有意义的。侧面证明了我三个值的精准。</p>
        <p>6. <strong>关于此页面的三阶校准</strong>：此是自然可感最小值，意味着可以快速调出你需要的精细值</p>
        <p>7. <strong>配套的校准工具</strong>：一般不必用，此工具在另一个网页。如果你摆动的距离天生比别人小或大，可以用。</p>
        <p style="color: var(--text-secondary); margin-top: 15px;">—— 西岛海</p>
    </div>
</div>

<div class="floating-author-link">
    <a href="https://space.bilibili.com/1534330" target="_blank">
        <span>作者 西岛海xlm</span>
    </a>
</div>

<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script>
    // 定义三个核心公式及其配置
    const formulaConfigs = [
        {
            id: 'speed',
            title: '偏向速准 (推荐)',
            desc: '公式: √(X+Y)',
            color: 'var(--accent-green)',
            calc: (x, y) => Math.sqrt(x + y)
        },
        {
            id: 'accuracy',
            title: '偏向瞄准（项目）',
            desc: '公式: √X + √Y',
            color: 'var(--accent-blue)',
            calc: (x, y) => Math.sqrt(x) + Math.sqrt(y)
        },
        {
            id: 'origin',
            title: '起源公式（追踪）',
            desc: '公式: √X',
            color: 'var(--text-secondary)',
            calc: (x, y) => Math.sqrt(x)
        }
    ];

    // 存储每个公式行的当前状态（倍率、当前校准基准值）
    const rowStates = {
        speed: { multiplier: 1.0, rawVal: 0, currentBase: 0 },
        accuracy: { multiplier: 1.0, rawVal: 0, currentBase: 0 },
        origin: { multiplier: 1.0, rawVal: 0, currentBase: 0 }
    };

    // 三阶校准法 Phase 3 参数 (引用自 index.html)
    // 左值(快) = (Base * 360) / (360 + 45)  =>  Factor approx 0.8888...
    // 右值(慢) = (Base * 360) / (360 - 45)  =>  Factor approx 1.1428...
    const P3_LEFT_FACTOR = 360 / (360 + 45);
    const P3_RIGHT_FACTOR = 360 / (360 - 45);

    // 初始化页面
    window.onload = function() {
        renderRows();
        calculateAll();
    };

    // 渲染三个结果行结构
    function renderRows() {
        const container = document.getElementById('resultsArea');
        container.innerHTML = '';

        formulaConfigs.forEach(config => {
            const html = `
            <div class="complex-result-row" id="row-${config.id}">
                <div class="panel-left">
                    <div class="panel-title"><i class="fas fa-times"></i> 倍率调整</div>
                    <input type="number" 
                           class="multiplier-input" 
                           value="1.0" 
                           step="0.05" 
                           onchange="updateMultiplier('${config.id}', this.value)"
                    >
                    <div style="font-size: 0.7rem; color: #666; margin-top: 5px;">影响理论值</div>
                </div>

                <div class="panel-center" style="border-top: 3px solid ${config.color}">
                    <div class="result-label">${config.title}</div>
                    <div class="result-value-main" id="val-main-${config.id}">--</div>
                    <div class="result-sub">${config.desc}</div>
                </div>

                <div class="panel-right">
                    <div class="calibration-header">
                        <span style="color: var(--accent-green); font-weight: bold;">
                            <i class="fas fa-crosshairs"></i> 三阶校准 (Ⅲ)
                        </span>
                        <button class="btn-reset" onclick="resetCalibration('${config.id}')">
                            <i class="fas fa-undo"></i> 重置
                        </button>
                    </div>
                    
                    <div class="current-base-wrapper">
                        <div style="font-size: 0.8rem; color: #888;">当前基准值 (cm)</div>
                        <div class="current-base-val" id="val-cal-${config.id}">--</div>
                    </div>

                    <div class="calibration-actions">
                        <button class="cal-btn btn-fast" onclick="applyCalibration('${config.id}', 'left')">
                            <strong><i class="fas fa-bolt"></i> 偏快</strong>
                            <span id="preview-fast-${config.id}">--</span>
                        </button>
                        <button class="cal-btn btn-slow" onclick="applyCalibration('${config.id}', 'right')">
                            <strong><i class="fas fa-mountain"></i> 偏慢</strong>
                            <span id="preview-slow-${config.id}">--</span>
                        </button>
                    </div>
                </div>
            </div>
            `;
            container.innerHTML += html;
        });
    }

    // 主计算函数
    function calculateAll() {
        const x = parseFloat(document.getElementById('x').value) || 0;
        const y = parseFloat(document.getElementById('y').value) || 0;

        formulaConfigs.forEach(config => {
            // 1. 计算原始理论值
            const raw = config.calc(x, y);
            rowStates[config.id].rawVal = raw;

            // 2. 更新显示并重置校准
            updateRowDisplay(config.id);
        });
    }

    // 更新倍率
    function updateMultiplier(id, value) {
        const val = parseFloat(value);
        if (isNaN(val) || val <= 0) return;
        rowStates[id].multiplier = val;
        updateRowDisplay(id); // 倍率改变会重置校准基准
    }

    // 重置校准（回到 理论值 * 倍率）
    function resetCalibration(id) {
        updateRowDisplay(id);
    }

    // 核心更新逻辑
    function updateRowDisplay(id) {
        const state = rowStates[id];
        
        // 计算带有倍率的基础值
        const baseWithMulti = state.rawVal * state.multiplier;
        state.currentBase = baseWithMulti; // 重置当前基准为理论值

        // 更新中间面板
        document.getElementById(`val-main-${id}`).textContent = baseWithMulti.toFixed(2);

        // 更新右侧面板显示
        updateCalibrationUI(id);
    }

    // 执行三阶校准点击
    function applyCalibration(id, side) {
        const state = rowStates[id];
        let newVal = 0;

        if (side === 'left') {
            // 调快 (数值变小)
            newVal = state.currentBase * P3_LEFT_FACTOR;
        } else {
            // 调慢 (数值变大)
            newVal = state.currentBase * P3_RIGHT_FACTOR;
        }

        state.currentBase = newVal;
        updateCalibrationUI(id);
    }

    // 仅更新右侧校准面板的数值
    function updateCalibrationUI(id) {
        const current = rowStates[id].currentBase;
        
        // 显示当前基准
        document.getElementById(`val-cal-${id}`).textContent = current.toFixed(2);

        // 计算并显示按钮上的预览值
        const nextFast = current * P3_LEFT_FACTOR;
        const nextSlow = current * P3_RIGHT_FACTOR;

        document.getElementById(`preview-fast-${id}`).textContent = nextFast.toFixed(2);
        document.getElementById(`preview-slow-${id}`).textContent = nextSlow.toFixed(2);
    }

</script>

</body>
</html>