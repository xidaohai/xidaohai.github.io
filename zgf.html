<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¥¿å²›æµ· Â· CM360æ­£æ”¹æ³•</title>
    <style>
    /* æ·»åŠ ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
    #themeToggle {
        transition: all 0.3s ease;
        box-shadow: var(--shadow-md);
    }
    
    #themeToggle:hover {
        transform: translateY(-2px);
        background: var(--accent-color);
    }

    /* æ·»åŠ ç³»ç»Ÿä¸»é¢˜æ£€æµ‹ */
    @media (prefers-color-scheme: dark) {
        body:not(.dark-theme) {
            --primary-color: #4299e1;
            --accent-color: #63b3ed;
            --text-dark: #e2e8f0;
            --text-light: #1a202c;
            --background-main: #1a202c;
            --background-panel: #2d3748;
            --border-color: #4a5568;
            --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
        }
    }
        
        :root {
            --primary-color: #2c5282;
            --accent-color: #3182ce;
            --text-dark: #2d3748;
            --text-light: #f7fafc;
            --background-main: #f0f4f8;
            --background-panel: #ffffff;
            --border-color: #cbd5e0;
            --shadow-md: 0 4px 6px rgba(0,0,0,0.05);
        }

        .dark-theme {
            --primary-color: #4299e1;
            --accent-color: #63b3ed;
            --text-dark: #e2e8f0;
            --text-light: #1a202c;
            --background-main: #1a202c;
            --background-panel: #2d3748;
            --border-color: #4a5568;
            --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Inter', system-ui;
            padding: 1rem;
            background: var(--background-main);
            color: var(--text-dark);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            transition: background 0.3s, color 0.3s;
        }

        .calculator-container {
            max-width: 500px;
            margin: 1rem auto;
            padding: 2rem;
            background: var(--background-panel);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .input-group {
            margin: 1.2rem 0;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #718096;
            font-size: 0.95rem;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 0.9rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--background-panel);
            color: var(--text-dark);
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.6rem;
            margin: 1rem 0;
        }

        button {
            padding: 0.7rem;
            background: var(--primary-color);
            color: var(--text-light);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        button:hover {
            background: var(--accent-color);
            transform: translateY(-1px);
        }

        .result-box {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--background-main);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        /* æ–°å¢å†å²è®°å½•æ ·å¼ */
        .history-item {
            padding: 0.5rem;
            margin: 0.2rem 0;
            background: var(--background-main);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-item:hover {
            background: var(--accent-color);
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <button id="themeToggle" style="position: fixed; top: 20px; right: 20px; padding: 10px 15px; border-radius: 8px; cursor: pointer; background: var(--primary-color); color: var(--text-light); border: none; z-index: 1000;">
        ğŸŒ™ é»‘å¤œæ¨¡å¼
    </button>

    <div class="calculator-container">
        <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 1.8rem;">
            è¥¿å²›æµ· Â· CM360æ­£æ”¹æ³•
        </h2>

        <div class="formula-display" style="margin: 1.5rem 0; padding: 1rem; background: var(--background-main); border-radius: 8px; font-family: monospace; color: var(--accent-color); font-size: 1.1em; text-align: center; border: 1px solid var(--border-color);"id="formulaDisplay">
            æ–°å€¼ = ( æ—§å€¼ Ã— 360Â°) Ã· ( 360Â°+ Î”å€¼ ) or å€ç‡ Ã— æ—§å€¼
        </div>

        <!-- æ ‡å‡†ç®—æ³• -->
        <div class="input-group">
            <label>æ—§å€¼ï¼ˆcm/360Â°ï¼‰ã€ä¸€èˆ¬åœ¨20-80ä¹‹é—´ã€‘</label>
            <input type="number" id="oldValue" step="0.1" value="50" oninput="calculate()">
        </div>

        <div class="input-group">
            <label>Î”è°ƒæ•´é‡ï¼ˆ360Â°Â± Î”Â°ï¼‰</label>
            <div class="preset-buttons">
                <button onclick="adjustDelta(0.25)">+0.25Â°</button>
                <button onclick="adjustDelta(1)">+1Â°</button>
                <button onclick="adjustDelta(10)">+10Â°</button>
                <button onclick="adjustDelta(-0.25)">-0.25Â°</button>
                <button onclick="adjustDelta(-1)">-1Â°</button>
                <button onclick="adjustDelta(-10)">-10Â°</button>
            </div>
            <input type="number" id="deltaValue" step="0.25" value="0" 
                   oninput="validateDelta()" placeholder="è¾“å…¥è°ƒæ•´åº¦æ•°">
        </div>

        <div class="result-box">
            <div style="color: #718096;">æ–°çµæ•åº¦å€¼</div>
            <div style="font-size: 2rem; color: var(--primary-color); margin: 1rem 0;">
                <span id="newValue">40.00</span> cm/360Â°
            </div>
        </div>

        <!-- æ‰‹è…•å‚æ•° -->
        <div class="input-group">
            <label>é¼ æ ‡è·ç¦»&å¯¹åº”è§’åº¦ï¼ˆä¸€èˆ¬æ‰‹è…•æ‘†åŠ¨ä¸€æ¬¡5cmï¼‰</label>
            <div class="preset-buttons">
                <button onclick="adjustWrist(5, 45)">45Â°</button>
                <button onclick="adjustWrist(5, 90)">90Â°</button>
                <button onclick="adjustWrist(5, 180)">180Â°</button>
            </div>
            <div style="display: flex; gap: 1rem;">
                <input type="number" id="wristDistance" step="0.1" value="5" oninput="calculateFromWrist()" placeholder="ç§»åŠ¨è·ç¦»">
                <input type="number" id="wristAngle" step="1" value="180" oninput="calculateFromWrist()" placeholder="å¯¹åº”è§’åº¦">
            </div>
        </div>

        <!-- ç›®æ ‡å‚æ•° -->
        <div class="input-group">
            <label>ç›®æ ‡è§’åº¦&é¼ æ ‡è·ç¦»ï¼ˆä¸€èˆ¬è¿‘ç›®æ ‡èº«ä½“å¤§å°3.6Â°ã€ä¸­è¿œ1Â°ã€‚ï¼‰</label>
            <div style="display: flex; gap: 1rem;">
                <input type="number" id="targetAngle" step="0.1" value="3.6" oninput="calculateFromTarget()" placeholder="ç›®æ ‡è§’åº¦">
                <input type="number" id="targetDistance" step="0.01" value="0.4" oninput="calculateFromTarget()" placeholder="å¯¹åº”è·ç¦»">
            </div>
        </div>

                <!-- æ–°å¢å†å²è®°å½•åŒºåŸŸ -->
                <div class="input-group">
                    <label>å†å²è®°å½•ï¼ˆç‚¹å‡»æ¢å¤ï¼‰</label>
                    <div id="historyList" class="result-box" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
    </div>

    <script>

    // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
    function toggleTheme() {
        document.body.classList.toggle('dark-theme');
        const isDark = document.body.classList.contains('dark-theme');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        updateToggleButton();
    }

    function updateToggleButton() {
    const toggleBtn = document.getElementById('themeToggle');
    const isDark = document.body.classList.contains('dark-theme');
    toggleBtn.textContent = isDark ? 'â˜€ï¸ ç™½å¤©æ¨¡å¼' : 'ğŸŒ™ é»‘å¤œæ¨¡å¼';
    // ä¿®å¤æ­¤è¡Œä»£ç 
    const color = getComputedStyle(document.documentElement).getPropertyValue(isDark ? '--accent-color' : '--primary-color');
    toggleBtn.style.background = color;
}

    // åˆå§‹åŒ–ä¸»é¢˜
    function initTheme() {
        const savedTheme = localStorage.getItem('theme') || 
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.body.classList.toggle('dark-theme', savedTheme === 'dark');
        updateToggleButton();
    }

    // åˆå§‹åŒ–æ—¶è°ƒç”¨
    initTheme();
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        let historyRecords = [];
    
        // å†å²è®°å½•æ˜¾ç¤ºæ›´æ–°
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = historyRecords.map((record, index) => `
                <div class="history-item" onclick="loadHistory(${index})">
                    [${record.time}] ${record.oldValue.toFixed(2)}cm â†’ ${record.newValue.toFixed(2)}cm (Î”${record.delta}Â°)
                </div>
            `).join('');
        }
    
        // åŠ è½½å†å²è®°å½•
        function loadHistory(index) {
            const record = historyRecords[index];
            if (!record) return;
    
            // æ¢å¤æ‰€æœ‰å‚æ•°
            document.getElementById('oldValue').value = record.oldValue;
            document.getElementById('deltaValue').value = record.delta;
            document.getElementById('wristDistance').value = record.wristDistance;
            document.getElementById('wristAngle').value = record.wristAngle;
            document.getElementById('targetAngle').value = record.targetAngle;
            document.getElementById('targetDistance').value = record.targetDistance;
            
            calculate(); // è§¦å‘é‡æ–°è®¡ç®—
        }
    
        // è¾“å…¥éªŒè¯
        function validateDelta() {
            const deltaInput = document.getElementById('deltaValue');
            let value = parseFloat(deltaInput.value) || 0;
            
            if (value <= -360) {
                value = -359.9;
                alert("è°ƒæ•´é‡ä¸èƒ½å°äº-359.9Â°");
            }
            if (value >= 360) {
                value = 359.9;
                alert("è°ƒæ•´é‡ä¸èƒ½è¶…è¿‡359.9Â°");
            }
            
            deltaInput.value = value.toFixed(2);
            calculate();
        }
    
        // è°ƒæ•´é‡å¿«æ·æ“ä½œ
        function adjustDelta(value) {
            const deltaInput = document.getElementById('deltaValue');
            deltaInput.value = (parseFloat(deltaInput.value) || 0) + value;
            validateDelta();
        }
    
        // æ‰‹è…•å‚æ•°å¿«æ·é¢„è®¾
        function adjustWrist(distance, angle) {
            document.getElementById('wristDistance').value = distance;
            document.getElementById('wristAngle').value = angle;
            calculateFromWrist();
        }
    
        // æ ¹æ®æ‰‹è…•å‚æ•°è®¡ç®—ï¼ˆä¿®æ”¹ç‚¹1/3ï¼‰
        function calculateFromWrist() {
            const distance = parseFloat(document.getElementById('wristDistance').value);
            const angle = parseFloat(document.getElementById('wristAngle').value);
            
            if(distance > 0 && angle > 0) {
                const newCM = (distance * 360) / angle;
                document.getElementById('oldValue').value = newCM.toFixed(2);
                calculate(); // è§¦å‘å®Œæ•´è®¡ç®—é“¾
            }
        }
    
        // æ ¹æ®ç›®æ ‡å‚æ•°è®¡ç®—ï¼ˆä¿®æ”¹ç‚¹2/3ï¼‰
        function calculateFromTarget() {
            const angle = parseFloat(document.getElementById('targetAngle').value);
            const distance = parseFloat(document.getElementById('targetDistance').value);
            
            if(angle > 0 && distance > 0) {
                const newCM = (distance * 360) / angle;
                document.getElementById('oldValue').value = newCM.toFixed(2);
                calculate(); // è§¦å‘å®Œæ•´è®¡ç®—é“¾
            }
        }
    
        // ä¸»è®¡ç®—å‡½æ•°ï¼ˆä¿®æ”¹ç‚¹3/3ï¼‰
        function calculate() {
            // è·å–è¾“å…¥å€¼
            const oldValue = parseFloat(document.getElementById('oldValue').value);
            const delta = parseFloat(document.getElementById('deltaValue').value);
            
            if(isNaN(oldValue) || isNaN(delta)) return;
            
            // è®¡ç®—æ–°çµæ•åº¦å€¼
            const newValue = (oldValue * 360) / (360 + delta);
            document.getElementById('newValue').textContent = newValue.toFixed(2);
    
            /* åŒæ­¥æ›´æ–°å…¶ä»–å‚æ•° */
            // åŒæ­¥æ‰‹è…•å‚æ•°ï¼ˆä½¿ç”¨æ–°å€¼è®¡ç®—ï¼‰
            const wristDistance = parseFloat(document.getElementById('wristDistance').value);
            if (!isNaN(wristDistance) && wristDistance > 0) {
                const calculatedAngle = (wristDistance * 360) / newValue; // å…³é”®ä¿®æ”¹
                document.getElementById('wristAngle').value = calculatedAngle.toFixed(1);
            }
    
            // åŒæ­¥ç›®æ ‡å‚æ•°
            const targetAngle = parseFloat(document.getElementById('targetAngle').value);
            document.getElementById('targetDistance').value = (newValue * targetAngle / 360).toFixed(2);
    
            // è®°å½•å†å²
            const historyItem = {
                time: new Date().toLocaleTimeString(),
                oldValue: oldValue,
                delta: delta.toFixed(2),
                newValue: newValue,
                wristDistance: wristDistance || parseFloat(document.getElementById('wristDistance').value),
                wristAngle: parseFloat(document.getElementById('wristAngle').value) || 0,
                targetAngle: targetAngle || 0,
                targetDistance: parseFloat(document.getElementById('targetDistance').value) || 0
            };
            
            // ä¿å­˜æœ€æ–°10æ¡è®°å½•
            historyRecords.unshift(historyItem);
            if (historyRecords.length > 10) historyRecords.pop();
            updateHistoryDisplay();
        }
    
        // åˆå§‹åŒ–è®¡ç®—
        calculate();
    </script>
</body>
</html>