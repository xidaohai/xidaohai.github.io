<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¥¿å²›æµ· Â· CM360æ­£æ”¹æ³•</title>
    <style>
    /* æ·»åŠ ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
    #themeToggle {
        transition: all 0.3s ease;
        box-shadow: var(--shadow-md);
    }
    
    #themeToggle:hover {
        transform: translateY(-2px);
        background: var(--accent-color);
    }

    /* æ·»åŠ ç³»ç»Ÿä¸»é¢˜æ£€æµ‹ */
    @media (prefers-color-scheme: dark) {
        body:not(.dark-theme) {
            --primary-color: #4299e1;
            --accent-color: #63b3ed;
            --text-dark: #e2e8f0;
            --text-light: #1a202c;
            --background-main: #1a202c;
            --background-panel: #2d3748;
            --border-color: #4a5568;
            --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
            --button-add-color: #2ecc71;
            --button-remove-color: #e74c3c;
        }
    }
        
    :root {
        --primary-color: #2c5282;
        --accent-color: #3182ce;
        --text-dark: #2d3748;
        --text-light: #f7fafc;
        --background-main: #f0f4f8;
        --background-panel: #ffffff;
        --border-color: #cbd5e0;
        --shadow-md: 0 4px 6px rgba(0,0,0,0.05);
        --button-add-color: #2ecc71;
        --button-remove-color: #e74c3c;
    }

    .dark-theme {
        --primary-color: #4299e1;
        --accent-color: #63b3ed;
        --text-dark: #e2e8f0;
        --text-light: #1a202c;
        --background-main: #1a202c;
        --background-panel: #2d3748;
        --border-color: #4a5568;
        --shadow-md: 0 4px 6px rgba(0,0,0,0.3);
        --button-add-color: #2ecc71;
        --button-remove-color: e74c3c;
    }

    body {
        font-family: 'Inter', system-ui;
        padding: 1rem;
        background: var(--background-main);
        color: var(--text-dark);
        min-height: 100vh;
        -webkit-tap-highlight-color: transparent;
        transition: background 0.3s, color 0.3s;
    }

    /* è°ƒæ•´å¸ƒå±€ä¸ºä¸€æ¨ªæ’ï¼Œå¹¶ç¼©å°æ¯ä¸ªæ¨¡å—å®½åº¦ */
    .main-container {
        display: flex;
        flex-wrap: nowrap; /* å¼ºåˆ¶ä¸æ¢è¡Œ */
        gap: 20px;
        justify-content: center;
        max-width: 1600px; /* è¶³å¤Ÿå®¹çº³æ‰€æœ‰æ¨¡å—çš„å®½åº¦ */
        margin: auto;
        overflow-x: auto; /* å¦‚æœå±å¹•ä¸å¤Ÿå®½ï¼Œå¯ä»¥æ¨ªå‘æ»šåŠ¨ */
        padding: 0 20px; /* å¢åŠ å·¦å³å†…è¾¹è·ï¼Œé˜²æ­¢è¢«åˆ‡ */
    }

    .calculator-container {
        max-width: 380px; /* ç¼©å°æœ€å¤§å®½åº¦ */
        min-width: 300px; /* ç¼©å°æœ€å°å®½åº¦ */
        margin: 1rem 0; /* è°ƒæ•´å¤–è¾¹è· */
        padding: 2rem;
        background: var(--background-panel);
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        flex: 1 1 340px; /* è°ƒæ•´flex-basis */
    }

    .input-group {
        margin: 1.2rem 0;
        padding: 1rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        position: relative;
    }
    
    .input-group.delta-calc {
        padding-top: 2rem;
    }

    label {
        display: block;
        margin-bottom: 0.5rem;
        color: #718096;
        font-size: 0.95rem;
        font-weight: 500;
    }

    input {
        width: 100%;
        padding: 0.9rem;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        background: var(--background-panel);
        color: var(--text-dark);
        font-size: 1rem;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }
    
    .input-row {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-top: 0.5rem;
    }

    .input-row input {
        flex: 1;
    }

    .preset-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.6rem;
        margin: 1rem 0;
    }

    button {
        padding: 0.7rem;
        background: var(--primary-color);
        color: var(--text-light);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    button:hover {
        background: var(--accent-color);
        transform: translateY(-1px);
    }

    .result-box {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background: var(--background-main);
        border-radius: 8px;
        border: 1px solid var(--border-color);
        text-align: center;
    }

    /* æ–°å¢å†å²è®°å½•æ ·å¼ */
    .history-item {
        padding: 0.5rem;
        margin: 0.2rem 0;
        background: var(--background-main);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .history-item:hover {
        background: var(--accent-color);
        color: var(--text-light);
    }
    
    .btn-calculate {
        background-color: var(--primary-color);
        color: var(--text-light);
    }
    
    .btn-calculate:hover {
        background-color: var(--accent-color);
    }
    
    .btn-add {
        background-color: var(--button-add-color);
        color: #fff;
    }
    
    .btn-add:hover {
        background-color: #27ae60;
    }
    
    .btn-remove {
        background-color: var(--button-remove-color);
        color: #fff;
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 8px 12px;
    }
    
    .result-group {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px dashed var(--border-color);
    }

    .result-row {
        display: flex;
        justify-content: center; /* å±…ä¸­æ˜¾ç¤º */
        align-items: center;
        padding: 15px;
        background-color: var(--background-main);
        border-radius: 6px;
        margin-bottom: 10px; /* æ·»åŠ é—´è· */
    }
    
    .result-label {
        font-weight: bold;
        color: var(--primary-color);
    }
    
    .result-value {
        font-size: 1.2rem;
        color: var(--primary-color);
    }

    .result-section {
        margin-top: 20px;
        border-top: 2px dashed var(--border-color);
        padding-top: 20px;
    }
    
    .result-section h3 {
        text-align: center;
        color: #718096;
        margin-bottom: 10px;
    }
    
    .toggle-mode-button {
        background: #6c757d;
        color: white;
        margin-bottom: 1rem;
    }

    /* æ‚¬æµ®ä½œè€…æ æ ·å¼ */
    .author-info {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 15px;
        background: var(--background-panel);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        box-shadow: var(--shadow-md);
        z-index: 999;
        font-size: 0.9em;
        transition: transform 0.3s ease;
    }
    
    .author-info a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: bold;
    }
    
    .author-info a:hover {
        text-decoration: underline;
    }

    </style>
</head>
<body>
    <button id="themeToggle" style="position: fixed; top: 20px; right: 20px; padding: 10px 15px; border-radius: 8px; cursor: pointer; background: var(--primary-color); color: var(--text-light); border: none; z-index: 1000;">
        ğŸŒ™ é»‘å¤œæ¨¡å¼
    </button>
    
    <div class="main-container">
        
        <div class="calculator-container">
            <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 1.8rem;">
                     å®è§‚ Â· å½“ä¸‹cm/360Â°å¢å‡æ³•
            </h2>

            <div class="formula-display" style="margin: 1.5rem 0; padding: 1rem; background: var(--background-main); border-radius: 8px; font-family: monospace; color: var(--accent-color); font-size: 1.1em; text-align: center; border: 1px solid var(--border-color);"id="formulaDisplay">
                æ–°å€¼ = ( æ—§å€¼ Ã— 360Â°) Ã· ( 360Â°+ Î”å€¼ ) = æ—§å€¼ Ã— [360 Ã·ï¼ˆ 360 Â± Î”å€¼ ï¼‰]
            </div>

            <div class="input-group">
                <label>æ—§å€¼ï¼ˆcm/360Â°ï¼‰ã€ä¸€èˆ¬åœ¨20-80ä¹‹é—´ã€‘</label>
                <input type="number" id="oldValue" step="0.1" value="50" oninput="calculate()">
            </div>

            <div class="input-group">
                <label>Î”è°ƒæ•´é‡ å½“ä¸‹cm/360Â°Â± Î”Â°</label>
                <div class="preset-buttons">
                    <button onclick="adjustDelta(0.25)">+0.25Â°</button>
                    <button onclick="adjustDelta(1)">+1Â°</button>
                    <button onclick="adjustDelta(10)">+10Â°</button>
                    <button onclick="adjustDelta(-0.25)">-0.25Â°</button>
                    <button onclick="adjustDelta(-1)">-1Â°</button>
                    <button onclick="adjustDelta(-10)">-10Â°</button>
                </div>
                <input type="number" id="deltaValue" step="0.25" value="0" 
                       oninput="calculate()" placeholder="è¾“å…¥è°ƒæ•´åº¦æ•°">
            </div>

            <div class="result-box">
                <div style="color: #718096;">æ–°çµæ•åº¦å€¼</div>
                <div style="font-size: 2rem; color: var(--primary-color); margin: 1rem 0;">
                    <span id="newValue">40.00</span> cm/360Â°
                </div>
            </div>

            <div class="input-group">
                <label>é¼ æ ‡è·ç¦»&å¯¹åº”è§’åº¦ï¼ˆä¸€èˆ¬æ‰‹è…•æ‘†åŠ¨ä¸€æ¬¡5cmï¼‰</label>
                <div class="preset-buttons">
                    <button onclick="adjustWrist(5, 45)">45Â°</button>
                    <button onclick="adjustWrist(5, 90)">90Â°</button>
                    <button onclick="adjustWrist(5, 180)">180Â°</button>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <input type="number" id="wristDistance" step="0.0001" value="5" oninput="calculateFromWrist()" placeholder="ç§»åŠ¨è·ç¦»">
                    <input type="number" id="wristAngle" step="1" value="180" oninput="calculateFromWrist()" placeholder="å¯¹åº”è§’åº¦">
                </div>
            </div>

            <div class="input-group">
                <label>ç›®æ ‡è§’åº¦&é¼ æ ‡è·ç¦»ï¼ˆä¸€èˆ¬è¿‘ç›®æ ‡èº«ä½“å¤§å°3.6Â°ã€ä¸­è¿œ1Â°ã€‚ï¼‰</label>
                <div style="display: flex; gap: 1rem;">
                    <input type="number" id="targetAngle" step="0.1" value="3.6" oninput="calculateFromTarget()" placeholder="ç›®æ ‡è§’åº¦">
                    <input type="number" id="targetDistance" step="0.01" value="0.4" oninput="calculateFromTarget()" placeholder="å¯¹åº”è·ç¦»">
                </div>
            </div>

            <div class="input-group">
                <label>å†å²è®°å½•ï¼ˆç‚¹å‡»æ¢å¤ï¼‰</label>
                <div id="historyList" class="result-box" style="max-height: 200px; overflow-y: auto;"></div>
            </div>
        </div>
        
        <div class="calculator-container">
            <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 1.8rem;">
                å¾®è§‚ Â· è§’é€Ÿåº¦å¢å‡æ³• (1cm C / 5cm A å€¼)
            </h2>
            <p style="text-align: center; color: #718096; margin-bottom: 1rem;">
                æ–°å€¼ = 360 / ( (360 / æ—§å€¼) + å¢é‡ / åŸºå‡†cm )
            </p>

            <div class="input-group">
                <label>æ—§å€¼ (cm/360Â°)</label>
                <input type="number" id="angularOldValue" step="0.1" value="50" oninput="calculateAngularVelocity()">
            </div>
            
            <div class="input-group" id="cValueGroup">
                <label>Cå€¼è°ƒæ•´é‡ 1cm / ï¼ŸÂ° Â± CÂ°</label>
                <div class="preset-buttons">
                    <button onclick="adjustAngularC(1, 0.25)">+0.25Â°</button>
                    <button onclick="adjustAngularC(1, 1)">+1Â°</button>
                    <button onclick="adjustAngularC(1, 10)">+10Â°</button>
                    <button onclick="adjustAngularC(1, -0.25)">-0.25Â°</button>
                    <button onclick="adjustAngularC(1, -1)">-1Â°</button>
                    <button onclick="adjustAngularC(1, -10)">-10Â°</button>
                </div>
                <input type="number" id="angularCValue" step="0.1" value="10" oninput="calculateAngularVelocity()" placeholder="è¾“å…¥Cå€¼ (1cmå¢é‡)">
            </div>
            
            <div class="input-group" id="aValueGroup" style="display: none;">
                <label>Aå€¼è°ƒæ•´é‡ 5cm / ï¼ŸÂ° Â± AÂ°</label>
                <div class="preset-buttons">
                    <button onclick="adjustAngularC(5, 0.25)">+0.25Â°</button>
                    <button onclick="adjustAngularC(5, 1)">+1Â°</button>
                    <button onclick="adjustAngularC(5, 10)">+10Â°</button>
                    <button onclick="adjustAngularC(5, -0.25)">-0.25Â°</button>
                    <button onclick="adjustAngularC(5, -1)">-1Â°</button>
                    <button onclick="adjustAngularC(5, -10)">-10Â°</button>
                </div>
                <input type="number" id="angularAValue" step="0.1" value="50" oninput="calculateAngularVelocity()" placeholder="è¾“å…¥Aå€¼ (5cmå¢é‡)">
            </div>
            
            <button class="toggle-mode-button" onclick="toggleAngularMode()">åˆ‡æ¢æ¨¡å¼ (å½“å‰: Cå€¼)</button>

            <div class="result-section">
                <h3>è®¡ç®—ç»“æœ</h3>
                <div class="result-row">
                    <span class="result-label">æ—§å€¼ (cm/360Â°):</span>
                    <span class="result-value" id="oldCmResult">50.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">æ—§å€¼è§’é€Ÿåº¦ (Â°/cm):</span>
                    <span class="result-value" id="oldAngularVelocityResult">7.20</span>
                </div>
                <div class="result-row">
                    <span class="result-label">æ–°å€¼ (cm/360Â°):</span>
                    <span class="result-value" id="newCmResult">40.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">æ–°å€¼è§’é€Ÿåº¦ (Â°/cm):</span>
                    <span class="result-value" id="newAngularVelocityResult">9.00</span>
                </div>
            </div>
        </div>
        <div class="calculator-container">
            <h2 id="mode-title" style="text-align: center; color: var(--primary-color); margin-bottom: 1.8rem;">
                Cå€¼è®¡ç®—å™¨
            </h2>
            <p id="mode-formula" style="text-align: center; color: #718096; margin-bottom: 1rem;">
                Cå€¼ = (360Â° Ã· æ–°å€¼) - (360Â° Ã· æ—§å€¼)
            </p>
            
            <button class="toggle-mode-button" onclick="toggleCDeltaMode()">åˆ‡æ¢è®¡ç®—æ¨¡å¼ (å½“å‰: Cå€¼)</button>
            
            <div id="delta-calculator-container">
                <div class="input-group delta-calc">
                    <button class="btn-remove" onclick="removeGroup(this)">åˆ é™¤</button>
                    <div class="input-row">
                        <label for="old-value-1">æ—§å€¼ (cm/360Â°):</label>
                        <input type="number" id="old-value-1" value="64.96">
                    </div>
                    <div class="input-row">
                        <label for="new-value-1">æ–°å€¼ (cm/360Â°):</label>
                        <input type="number" id="new-value-1" placeholder="ä¾‹å¦‚: 52.78">
                    </div>
                    <div class="result-group" id="result-group-1" style="display: none;">
                        <div class="result-row">
                            <span class="result-label" id="combined-result-1">--</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn-calculate" onclick="calculateAll()"><i class="fas fa-calculator"></i> è®¡ç®—æ‰€æœ‰</button>
                <button class="btn-add" onclick="addGroup()"><i class="fas fa-plus"></i> å¢åŠ å¯¹æ¯”ç»„</button>
            </div>
        </div>

        <div class="calculator-container">
            <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 1.8rem;">
                ç™¾åˆ†æ¯”å¢å‡è®¡ç®—å™¨
            </h2>
            <p style="text-align: center; color: #718096; margin-bottom: 1rem;">
                è®¡ç®—ä¸¤ä¸ªåŸºå‡†å€¼çš„ Â± ç™¾åˆ†æ¯”ç»“æœ
            </p>

            <div class="input-group">
                <label>ç™¾åˆ†æ¯” (%)</label>
                <input type="number" id="percentageInput" step="0.1" value="10" oninput="calculatePercentage()">
            </div>
            
            <div class="input-group">
                <label>åŸºå‡†å€¼ä¸€</label>
                <input type="number" id="baseValue1Input" step="0.01" value="50" oninput="calculatePercentage()">
            </div>
            
            <div class="input-group">
                <label>åŸºå‡†å€¼äºŒ</label>
                <input type="number" id="baseValue2Input" step="0.01" value="60" oninput="calculatePercentage()">
            </div>

            <div class="result-section">
                <h3>åŸºå‡†å€¼ä¸€</h3>
                <div class="result-row">
                    <span class="result-label">å¢åŠ åçš„å€¼:</span>
                    <span class="result-value" id="increaseResult1">55.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">å‡å°‘åçš„å€¼:</span>
                    <span class="result-value" id="decreaseResult1">45.00</span>
                </div>
            </div>
            
            <div class="result-section">
                <h3>åŸºå‡†å€¼äºŒ</h3>
                <div class="result-row">
                    <span class="result-label">å¢åŠ åçš„å€¼:</span>
                    <span class="result-value" id="increaseResult2">66.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">å‡å°‘åçš„å€¼:</span>
                    <span class="result-value" id="decreaseResult2">54.00</span>
                </div>
            </div>
        </div>
        
    </div>

    <div class="author-info">
        <p style="margin: 0; padding: 0;">ä½œè€…: è¥¿å²›æµ·xlm</p>
        <a href="https://space.bilibili.com/1534330" target="_blank" rel="noopener noreferrer">æˆ‘çš„Bilibiliä¸»é¡µ</a>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateToggleButton();
        }

        function updateToggleButton() {
            const toggleBtn = document.getElementById('themeToggle');
            const isDark = document.body.classList.contains('dark-theme');
            toggleBtn.textContent = isDark ? 'â˜€ï¸ ç™½å¤©æ¨¡å¼' : 'ğŸŒ™ é»‘å¤œæ¨¡å¼';
            const color = getComputedStyle(document.documentElement).getPropertyValue(isDark ? '--accent-color' : '--primary-color');
            toggleBtn.style.background = color;
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.body.classList.toggle('dark-theme', savedTheme === 'dark');
            updateToggleButton();
        }

        // åˆå§‹åŒ–æ—¶è°ƒç”¨
        initTheme();
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        let historyRecords = [];
        // å†å²è®°å½•æ˜¾ç¤ºæ›´æ–°
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = historyRecords.map((record, index) => `
                <div class="history-item" onclick="loadHistory(${index})">
                    [${record.time}] ${record.oldValue.toFixed(2)}cm â†’ ${record.newValue.toFixed(2)}cm (Î”${record.delta}Â°)
                </div>
            `).join('');
        }
    
        // åŠ è½½å†å²è®°å½•
        function loadHistory(index) {
            const record = historyRecords[index];
            if (!record) return;
    
            // æ¢å¤æ‰€æœ‰å‚æ•°
            document.getElementById('oldValue').value = record.oldValue;
            document.getElementById('deltaValue').value = record.delta;
            document.getElementById('wristDistance').value = record.wristDistance;
            document.getElementById('wristAngle').value = record.wristAngle;
            document.getElementById('targetAngle').value = record.targetAngle;
            document.getElementById('targetDistance').value = record.targetDistance;
            
            calculate();
        }
    
        // è°ƒæ•´é‡å¿«æ·æ“ä½œ
        function adjustDelta(value) {
            const deltaInput = document.getElementById('deltaValue');
            deltaInput.value = (parseFloat(deltaInput.value) || 0) + value;
            calculate();
        }
    
        // æ‰‹è…•å‚æ•°å¿«æ·é¢„è®¾
        function adjustWrist(distance, angle) {
            document.getElementById('wristDistance').value = distance;
            document.getElementById('wristAngle').value = angle;
            calculateFromWrist();
        }
    
        // æ ¹æ®æ‰‹è…•å‚æ•°è®¡ç®—
        function calculateFromWrist() {
            const distance = parseFloat(document.getElementById('wristDistance').value);
            const angle = parseFloat(document.getElementById('wristAngle').value);
            
            if(distance > 0 && angle > 0) {
                const newCM = (distance * 360) / angle;
                document.getElementById('oldValue').value = newCM.toFixed(4); // ä¿æŒç²¾åº¦
                calculate();
            }
        }
    
        // æ ¹æ®ç›®æ ‡å‚æ•°è®¡ç®—
        function calculateFromTarget() {
            const angle = parseFloat(document.getElementById('targetAngle').value);
            const distance = parseFloat(document.getElementById('targetDistance').value);
            
            if(angle > 0 && distance > 0) {
                const newCM = (distance * 360) / angle;
                document.getElementById('oldValue').value = newCM.toFixed(4); // ä¿æŒç²¾åº¦
                calculate();
            }
        }
    
        // ä¸»è®¡ç®—å‡½æ•°
        function calculate() {
            const oldValue = parseFloat(document.getElementById('oldValue').value);
            const delta = parseFloat(document.getElementById('deltaValue').value);
            
            if(isNaN(oldValue) || isNaN(delta) || (360 + delta) === 0) {
                document.getElementById('newValue').textContent = 'è¾“å…¥æ— æ•ˆ';
                return;
            }
            
            const newValue = (oldValue * 360) / (360 + delta);
            document.getElementById('newValue').textContent = newValue.toFixed(2); // å®è§‚æ¨¡å—çš„ç»“æœä¿ç•™ä¸¤ä½
    
            const wristDistance = parseFloat(document.getElementById('wristDistance').value);
            if (!isNaN(wristDistance) && wristDistance > 0) {
                const calculatedAngle = (wristDistance * 360) / newValue;
                document.getElementById('wristAngle').value = calculatedAngle.toFixed(1);
            }
    
            const targetAngle = parseFloat(document.getElementById('targetAngle').value);
            document.getElementById('targetDistance').value = (newValue * targetAngle / 360).toFixed(2);
    
            const historyItem = {
                time: new Date().toLocaleTimeString(),
                oldValue: oldValue,
                delta: delta.toFixed(8),
                newValue: newValue,
                wristDistance: wristDistance || parseFloat(document.getElementById('wristDistance').value),
                wristAngle: parseFloat(document.getElementById('wristAngle').value) || 0,
                targetAngle: targetAngle || 0,
                targetDistance: parseFloat(document.getElementById('targetDistance').value) || 0
            };
            historyRecords.unshift(historyItem);
            if (historyRecords.length > 10) historyRecords.pop();
            updateHistoryDisplay();
        }
    
        // åˆå§‹åŒ–è®¡ç®—
        calculate();

        // **å¾®è§‚Â·è§’é€Ÿåº¦å¢å‡æ³• (1cm Cå€¼ / 5cm Aå€¼) é€»è¾‘**
        let isCModeAngular = true; // é»˜è®¤æ˜¯Cå€¼ (1cm) æ¨¡å¼
        
        function toggleAngularMode() {
            isCModeAngular = !isCModeAngular;
            const cGroup = document.getElementById('cValueGroup');
            const aGroup = document.getElementById('aValueGroup');
            const toggleBtn = document.querySelector('#cValueGroup').closest('.calculator-container').querySelector('.toggle-mode-button');
            
            if (isCModeAngular) {
                cGroup.style.display = 'block';
                aGroup.style.display = 'none';
                toggleBtn.textContent = 'åˆ‡æ¢æ¨¡å¼ (å½“å‰: Cå€¼)';
            } else {
                cGroup.style.display = 'none';
                aGroup.style.display = 'block';
                toggleBtn.textContent = 'åˆ‡æ¢æ¨¡å¼ (å½“å‰: Aå€¼)';
            }
            calculateAngularVelocity();
        }

        // è§’é€Ÿåº¦ç»å¯¹å¢é‡è®¡ç®—å™¨ (å·²ä¿®æ”¹ä¸ºæ”¯æŒ1cm Cå€¼å’Œ5cm Aå€¼)
        function calculateAngularVelocity() {
            const oldValue = parseFloat(document.getElementById('angularOldValue').value);
            
            let cValue;
            let cmBase;

            if (isCModeAngular) {
                cValue = parseFloat(document.getElementById('angularCValue').value);
                cmBase = 1; // Cå€¼åŸºäº1cm
            } else {
                cValue = parseFloat(document.getElementById('angularAValue').value);
                cmBase = 5; // Aå€¼åŸºäº5cm
            }
            
            const oldCmResultElement = document.getElementById('oldCmResult');
            const oldAngularVelocityResultElement = document.getElementById('oldAngularVelocityResult');
            const newCmResultElement = document.getElementById('newCmResult');
            const newAngularVelocityResultElement = document.getElementById('newAngularVelocityResult');

            if (isNaN(oldValue) || isNaN(cValue) || oldValue === 0) {
                const invalid = 'è¾“å…¥æ— æ•ˆ';
                oldCmResultElement.textContent = invalid;
                oldAngularVelocityResultElement.textContent = invalid;
                newCmResultElement.textContent = invalid;
                newAngularVelocityResultElement.textContent = invalid;
                return;
            }

            const oldAngularVelocity = 360 / oldValue;
            
            // æ ¸å¿ƒè®¡ç®—é€»è¾‘ï¼šcValueæ˜¯åŸºäºcmBaseè·ç¦»çš„è§’åº¦å˜åŒ–é‡ï¼Œå› æ­¤æ¯å˜ç±³çš„è§’é€Ÿåº¦å˜åŒ–é‡æ˜¯ cValue / cmBase
            const angularChangePerCm = cValue / cmBase;
            
            if (oldAngularVelocity + angularChangePerCm <= 0) {
                newCmResultElement.textContent = 'æ¥è¿‘æ— ç©·';
                newAngularVelocityResultElement.textContent = 'è¾“å…¥æ— æ•ˆ';
                return;
            }
            
            const newAngularVelocity = oldAngularVelocity + angularChangePerCm;
            const newValue = 360 / newAngularVelocity;


            oldCmResultElement.textContent = oldValue.toFixed(2);
            oldAngularVelocityResultElement.textContent = oldAngularVelocity.toFixed(2);
            newCmResultElement.textContent = newValue.toFixed(2);
            newAngularVelocityResultElement.textContent = newAngularVelocity.toFixed(2);
        }

        // è§’é€Ÿåº¦ç»å¯¹å¢é‡å¿«æ·æ“ä½œ (å·²ä¿®æ”¹ä¸ºæ”¯æŒ1cm Cå€¼å’Œ5cm Aå€¼)
        function adjustAngularC(cmBase, value) {
            const cInput = document.getElementById(cmBase === 1 ? 'angularCValue' : 'angularAValue');
            cInput.value = (parseFloat(cInput.value) || 0) + value;
            
            // ç¡®ä¿åˆ‡æ¢åˆ°æ­£ç¡®çš„æ¨¡å¼
            if ((cmBase === 1 && !isCModeAngular) || (cmBase === 5 && isCModeAngular)) {
                toggleAngularMode();
            } else {
                calculateAngularVelocity();
            }
        }
        
        // **çµæ•åº¦ Cå€¼/Aå€¼/Î”å€¼è®¡ç®—å™¨é€»è¾‘**
        let isCDeltaMode = 0; // 0: Cå€¼, 1: Aå€¼, 2: Î”å€¼

        function toggleCDeltaMode() {
            isCDeltaMode = (isCDeltaMode + 1) % 3;
            const modeTitle = document.getElementById('mode-title');
            const modeFormula = document.getElementById('mode-formula');
            const toggleButton = document.querySelector('#delta-calculator-container').closest('.calculator-container').querySelector('.toggle-mode-button');
            
            if (isCDeltaMode === 0) { // Cå€¼æ¨¡å¼
                modeTitle.textContent = "Cå€¼è®¡ç®—å™¨";
                modeFormula.textContent = "Cå€¼ = (360Â° Ã· æ–°å€¼) - (360Â° Ã· æ—§å€¼)";
                toggleButton.textContent = "åˆ‡æ¢è®¡ç®—æ¨¡å¼ (å½“å‰: Cå€¼)";
            } else if (isCDeltaMode === 1) { // Aå€¼æ¨¡å¼
                modeTitle.textContent = "Aå€¼è®¡ç®—å™¨";
                modeFormula.textContent = "Aå€¼ = 5 Ã— [ (360Â° Ã· æ–°å€¼) - (360Â° Ã· æ—§å€¼) ]";
                toggleButton.textContent = "åˆ‡æ¢è®¡ç®—æ¨¡å¼ (å½“å‰: Aå€¼)";
            } else { // Î”å€¼æ¨¡å¼
                modeTitle.textContent = "Î”å€¼è®¡ç®—å™¨";
                modeFormula.textContent = "Î”å€¼ = (æ—§å€¼ Ã— 360Â°) Ã· æ–°å€¼ - 360Â°";
                toggleButton.textContent = "åˆ‡æ¢è®¡ç®—æ¨¡å¼ (å½“å‰: Î”å€¼)";
            }
            calculateAll();
        }
        
        let groupCount = 1;
        function calculateAll() {
            for (let i = 1; i <= groupCount; i++) {
                const oldInput = document.getElementById(`old-value-${i}`);
                const newInput = document.getElementById(`new-value-${i}`);
                const resultGroup = document.getElementById(`result-group-${i}`);
                const combinedResultOutput = document.getElementById(`combined-result-${i}`);
                
                if (oldInput && newInput && resultGroup && combinedResultOutput) {
                    const oldValue = parseFloat(oldInput.value);
                    const newValue = parseFloat(newInput.value);
        
                    if (!isNaN(oldValue) && !isNaN(newValue) && oldValue !== 0 && newValue !== 0) {
                        let resultValue;
                        let resultLabel;
                        
                        const angularChange = (360 / newValue) - (360 / oldValue); // æ¯å˜ç±³çš„è§’é€Ÿåº¦å˜åŒ–é‡ (Cå€¼çš„åŸºç¡€)
                        
                        if (isCDeltaMode === 0) { // Cå€¼æ¨¡å¼ (1cm)
                            resultValue = angularChange;
                            resultLabel = `Cå€¼: ${resultValue >= 0 ? '+' : ''}${resultValue.toFixed(8)}Â°`;
                        } else if (isCDeltaMode === 1) { // Aå€¼æ¨¡å¼ (5cm)
                            resultValue = angularChange * 5; // Aå€¼ = 5 * Cå€¼
                            resultLabel = `Aå€¼: ${resultValue >= 0 ? '+' : ''}${resultValue.toFixed(8)}Â°`;
                        } else { // Î”å€¼æ¨¡å¼
                            resultValue = (oldValue * 360) / newValue - 360;
                            resultLabel = `Î”å€¼: ${resultValue >= 0 ? '+' : ''}${resultValue.toFixed(8)}Â°`;
                        }
                        
                        combinedResultOutput.textContent = resultLabel;
                        resultGroup.style.display = 'block';
                    } else {
                        combinedResultOutput.textContent = 'è¾“å…¥æ— æ•ˆ';
                        resultGroup.style.display = 'block';
                    }
                }
            }
        }
        
        function addGroup() {
            groupCount++;
            const container = document.getElementById('delta-calculator-container');
            const newGroupHtml = `
                <div class="input-group delta-calc">
                    <button class="btn-remove" onclick="removeGroup(this)">åˆ é™¤</button>
                    <div class="input-row">
                        <label for="old-value-${groupCount}">æ—§å€¼ (cm/360Â°):</label>
                        <input type="number" id="old-value-${groupCount}">
                    </div>
                    <div class="input-row">
                        <label for="new-value-${groupCount}">æ–°å€¼ (cm/360Â°):</label>
                        <input type="number" id="new-value-${groupCount}" placeholder="ä¾‹å¦‚: 52.78">
                    </div>
                    <div class="result-group" id="result-group-${groupCount}" style="display: none;">
                        <div class="result-row">
                            <span class="result-label" id="combined-result-${groupCount}">--</span>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', newGroupHtml);
        }

        function removeGroup(button) {
            const group = button.closest('.input-group');
            if (group) {
                group.remove();
            }
        }

        // ç™¾åˆ†æ¯”å¢å‡è®¡ç®—å™¨
        function calculatePercentage() {
            const percentage = parseFloat(document.getElementById('percentageInput').value);
            const baseValue1 = parseFloat(document.getElementById('baseValue1Input').value);
            const baseValue2 = parseFloat(document.getElementById('baseValue2Input').value);

            const increaseResult1Element = document.getElementById('increaseResult1');
            const decreaseResult1Element = document.getElementById('decreaseResult1');
            const increaseResult2Element = document.getElementById('increaseResult2');
            const decreaseResult2Element = document.getElementById('decreaseResult2');

            if (isNaN(percentage) || isNaN(baseValue1)) {
                increaseResult1Element.textContent = 'è¾“å…¥æ— æ•ˆ';
                decreaseResult1Element.textContent = 'è¾“å…¥æ— æ•ˆ';
            } else {
                increaseResult1Element.textContent = (baseValue1 * (1 + percentage / 100)).toFixed(2);
                decreaseResult1Element.textContent = (baseValue1 * (1 - percentage / 100)).toFixed(2);
            }
            
            if (isNaN(percentage) || isNaN(baseValue2)) {
                increaseResult2Element.textContent = 'è¾“å…¥æ— æ•ˆ';
                decreaseResult2Element.textContent = 'è¾“å…¥æ— æ•ˆ';
            } else {
                increaseResult2Element.textContent = (baseValue2 * (1 + percentage / 100)).toFixed(2);
                decreaseResult2Element.textContent = (baseValue2 * (1 - percentage / 100)).toFixed(2);
            }
        }

        // åˆå§‹åŒ–æ‰€æœ‰è®¡ç®—
        calculatePercentage();
        calculateAngularVelocity();
        calculateAll();
    </script>
</body>
</html>